<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brolingboke D.O.C. - GrandLine XP</title>
<style>
:root {
  --xp-window-bg: #ece9d8;
  --xp-input-border: #7f9db9;
  --xp-selection: #316ac5;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Tahoma', 'Segoe UI', sans-serif;
  overflow: hidden;
  height: 100vh;
  cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="19"><path fill="white" stroke="black" d="M0,0 L0,16 L4,12 L7,18 L9,17 L6,11 L11,11 Z"/></svg>') 0 0, auto;
}
#bios {
  position: fixed;
  inset: 0;
  background: #000;
  color: #aaaaaa;
  font-family: 'Consolas', 'Courier New', monospace;
  font-size: 13px;
  padding: 0;
  z-index: 1004;
  display: flex;
  flex-direction: column;
  line-height: 1.5;
}
#bios-header {
  background: #0000aa;
  color: #ffff00;
  padding: 8px 15px;
  text-align: center;
  font-weight: bold;
  letter-spacing: 2px;
  font-size: 14px;
}
#bios-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 20px;
}
#bios-text { 
  white-space: pre; 
  text-align: left;
  max-width: 600px;
  color: #0f0;
}
#bios-text .highlight { color: #ffffff; }
#bios-text .success { color: #00aa00; }
#bios-text .value { color: #00aaaa; }
#bios-prompt {
  color: #ffffff;
  background: #000;
  padding: 10px 20px;
  border: 1px solid #333;
  text-align: center;
  animation: blink-cursor 1s infinite;
  margin: 20px auto;
}
#bios-footer {
  display: flex;
  justify-content: space-between;
  padding: 12px 20px;
  border-top: 1px solid #333;
  color: #666;
  font-size: 11px;
  background: #111;
}
@keyframes blink-cursor {
  0%, 50% { border-left: 2px solid #aaa; }
  51%, 100% { border-left: 2px solid transparent; }
}
#boot {
  position: fixed;
  inset: 0;
  background: linear-gradient(180deg, #000 0%, #000a1a 50%, #000 100%);
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1003;
}
#boot-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
}
#boot-logo {
  width: 150px;
  height: 150px;
  animation: logo-pulse 2s ease-in-out infinite;
}
@keyframes logo-pulse {
  0%, 100% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.05); opacity: 1; }
}
#boot-text {
  color: #fff;
  font-family: 'Franklin Gothic Medium', 'Trebuchet MS', sans-serif;
  font-size: 32px;
  letter-spacing: 1px;
  font-weight: bold;
  text-shadow: 0 0 30px rgba(0, 153, 255, 0.6), 2px 2px 8px rgba(0,0,0,0.8);
  margin-top: 30px;
}
#boot-subtext {
  color: #ccc;
  font-family: 'Franklin Gothic Medium', 'Trebuchet MS', sans-serif;
  font-size: 18px;
  font-style: italic;
  margin-top: 5px;
  letter-spacing: 3px;
}
#boot-bottom {
  padding: 40px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}
#boot-dots { 
  display: flex; 
  gap: 12px; 
}
#boot-dots span {
  width: 14px;
  height: 14px;
  background: linear-gradient(135deg, #0099ff, #00ccff);
  border-radius: 50%;
  animation: boot-dot 1.4s ease-in-out infinite;
  box-shadow: 0 0 10px rgba(0, 153, 255, 0.6);
}
#boot-dots span:nth-child(1) { animation-delay: 0s; }
#boot-dots span:nth-child(2) { animation-delay: 0.2s; }
#boot-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes boot-dot {
  0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
  40% { transform: scale(1); opacity: 1; }
}
#boot-copyright {
  color: #555;
  font-size: 11px;
  font-family: 'Tahoma', sans-serif;
}
#startup {
  position: fixed;
  inset: 0;
  background: linear-gradient(180deg, #000022 0%, #001144 30%, #002266 50%, #001144 70%, #000022 100%);
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1002;
  overflow: hidden;
}
#startup::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at center, rgba(0,100,200,0.2) 0%, transparent 60%);
  animation: startup-glow 3s ease-in-out infinite;
}
@keyframes startup-glow {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}
#startup-logo-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 25px;
  z-index: 1;
}
#startup-logo-img {
  width: 140px;
  height: 140px;
  animation: startup-logo-anim 3s ease-in-out infinite;
}
@keyframes startup-logo-anim {
  0%, 100% { transform: scale(1) rotateZ(0deg); filter: drop-shadow(0 0 0px rgba(100,200,255,0.3)); }
  50% { transform: scale(1.08) rotateZ(1deg); filter: drop-shadow(0 0 20px rgba(100,200,255,0.6)); }
}
#startup-logo {
  font-family: 'Franklin Gothic Medium', 'Trebuchet MS', sans-serif;
  font-size: 48px;
  color: #fff;
  text-shadow: 0 0 40px rgba(100,150,255,0.8), 2px 2px 8px rgba(0,0,0,0.9), 0 0 80px rgba(0,100,200,0.4);
  font-weight: normal;
  font-style: italic;
  letter-spacing: 0px;
}
#startup-logo span { 
  font-weight: bold; 
  font-style: normal;
}
#startup-bar-container { 
  width: 250px; 
  z-index: 1;
  margin-top: 50px;
}
#startup-bar {
  height: 18px;
  background: #0a0a1e;
  border: 2px solid #0066cc;
  border-radius: 10px;
  overflow: hidden;
  position: relative;
  box-shadow: 0 0 20px rgba(0,100,200,0.3);
}
#startup-progress {
  position: absolute;
  top: 2px;
  left: 2px;
  bottom: 2px;
  width: 0%;
  background: linear-gradient(90deg, #0099ff 0%, #00ccff 50%, #0099ff 100%);
  border-radius: 8px;
  transition: width 0.1s;
  box-shadow: 0 0 10px rgba(0,200,255,0.8);
}
#startup-text {
  color: #88ccff;
  font-size: 11px;
  z-index: 1;
  font-family: 'Tahoma', sans-serif;
  margin-top: 12px;
  text-shadow: 0 0 10px rgba(0,200,255,0.5);
}
#startup-copyright {
  color: #446688;
  font-size: 10px;
  z-index: 1;
  font-family: 'Tahoma', sans-serif;
  margin-top: 30px;
}
#desktop {
  position: fixed;
  inset: 0;
  background: #245edb;
  display: none;
  z-index: 1001;
}
#desktop-wallpaper {
  position: absolute;
  inset: 0;
  background-image: 
    linear-gradient(135deg, transparent 25%, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.03) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.03) 75%),
    linear-gradient(45deg, #1a4a9e 0%, #2563c9 50%, #5890d8 100%);
  background-size: 60px 60px, 100% 100%;
  background-position: 0 0, center;
}
#desktop-wallpaper::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 180px;
  opacity: 0.08;
  font-weight: bold;
  color: #fff;
  text-shadow: 0 0 40px rgba(255,255,255,0.3);
  content: 'üèõÔ∏è';
  animation: wallpaper-pulse 8s ease-in-out infinite;
}
@keyframes wallpaper-pulse {
  0%, 100% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -50%) scale(1.05); }
}
#desktop-wallpaper::after {
  content: 'BROLINGBOKE D.O.C.';
  position: absolute;
  bottom: 40px;
  right: 40px;
  font-size: 14px;
  color: rgba(255,255,255,0.4);
  font-weight: bold;
  letter-spacing: 2px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}
#desktop-icons {
  padding: 15px;
  display: flex;
  flex-direction: column;
   flex-wrap: wrap;
  gap: 5px;
  position: relative;
  z-index: 1;
  height: calc(100vh - 60px);
  align-content: flex-start;
}
.desktop-icon {
  width: 75px;
  text-align: center;
  cursor: pointer;
  padding: 5px;
  border: 1px solid transparent;
  border-radius: 3px;
  transition: all 0.12s ease;
  box-shadow: 0 1px 1px rgba(0,0,0,0.12);
}
.desktop-icon:hover {
  background: rgba(80, 140, 220, 0.4);
  border-color: rgba(100, 160, 240, 0.6);
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.desktop-icon:active, .desktop-icon.selected {
  background: rgba(60, 120, 200, 0.6);
  border-color: rgba(80, 140, 220, 0.8);
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.25), 0 0 0 2px rgba(255,255,255,0.35);
}
.desktop-icon-img {
  width: 48px;
  height: 48px;
  margin: 0 auto 4px;
  background: linear-gradient(135deg, #1a5cb8 0%, #2d7dd9 50%, #1a5cb8 100%);
  border: 2px solid rgba(255,255,255,0.8);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.4), 0 2px 4px rgba(0,0,0,0.3), 0 4px 8px rgba(0,0,0,0.2);
  position: relative;
  overflow: hidden;
}
.desktop-icon-img::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 50%;
  background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 100%);
  border-radius: 4px 4px 0 0;
}
.desktop-icon-label {
  color: #fff;
  font-size: 11px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.9), 0 0 3px rgba(0,0,0,0.5);
  line-height: 1.3;
  word-wrap: break-word;
}
.folder-icon .desktop-icon-img {
  background: linear-gradient(135deg, #ffcc66 0%, #ffaa00 50%, #cc8800 100%);
  border-color: #996600;
}
.computer-icon .desktop-icon-img {
  background: linear-gradient(135deg, #5a5a5a 0%, #3a3a3a 50%, #2a2a2a 100%);
  border-color: #888;
}
.recycle-icon .desktop-icon-img {
  background: linear-gradient(135deg, #4a90c4 0%, #2a6a94 50%, #1a5074 100%);
  border-color: #6ab0e4;
}
.game-icon .desktop-icon-img {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 50%, #6c3483 100%);
  border-color: #c39bd3;
}
.email-icon .desktop-icon-img {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 50%, #922b21 100%);
  border-color: #ec7063;
}
.txt-icon .desktop-icon-img {
  background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 50%, #d0d0d0 100%);
  border-color: #aaa;
}
.pdf-icon .desktop-icon-img {
  background: linear-gradient(135deg, #ff4444 0%, #cc2222 50%, #aa1111 100%);
  border-color: #ff6666;
}
.shortcut-icon .desktop-icon-img {
  background: linear-gradient(135deg, #5dade2 0%, #3498db 50%, #2980b9 100%);
  border-color: #85c1e9;
}
#taskbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 30px;
  background: linear-gradient(180deg, #3168d5 0%, #4993e6 3%, #2157d0 4%, #2663e0 10%, #1c4cc4 90%, #1941a5 96%, #1941a5 100%);
  border-top: 1px solid #0d3ba8;
  display: none;
  align-items: center;
  padding: 0 2px;
  z-index: 1005;
}
#start-btn {
  height: 24px;
  background: linear-gradient(180deg, #3c9a41 0%, #52b858 8%, #3c9a41 18%, #368f39 92%, #276d2a 100%);
  border: none;
  border-radius: 0 8px 8px 0;
  padding: 0 12px 0 6px;
  color: #fff;
  font-family: 'Franklin Gothic Medium', 'Trebuchet MS', sans-serif;
  font-size: 13px;
  font-weight: bold;
  font-style: italic;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.4), 0 1px 2px rgba(0,0,0,0.3);
  text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
  transition: filter 0.1s;
}
#start-btn:hover { filter: brightness(1.1); }
#start-btn:active { filter: brightness(0.95); box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); }
.start-orb {
  width: 18px;
  height: 18px;
  background: linear-gradient(135deg, #5fd865 0%, #2a8f2f 50%, #1a6d1f 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-style: normal;
  box-shadow: inset 0 -2px 4px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.3);
}
#start-menu {
  position: fixed;
  bottom: 30px;
  left: 1;
  width: 390px;
  height: auto;
  max-height: 500px;
  background: linear-gradient(180deg, #fff 0%, #f8f6f0 100%);
  border: 1px solid #0054e3;
  border-radius: 6px 6px 0 0;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.4);
  display: none;
  z-index: 1006;
  overflow: hidden;
  flex-direction: column;
}
#start-menu-header {
  padding: 12px 15px;
  background: linear-gradient(180deg, #3a7be8 0%, #1a5cb8 100%);
  color: #fff;
  display: flex;
  align-items: center;
  gap: 12px;
  border-bottom: 2px solid #1a5cb8;
  flex-shrink: 0;
}
#start-menu-avatar {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  flex-shrink: 0;
  min-width: 0;
  overflow: hidden;
}
#start-menu-user-name {
  font-size: 14px;
  font-weight: bold;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#start-menu-user-role {
  font-size: 10px;
  opacity: 0.9;
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#start-menu-content {
  display: flex;
  flex-direction: row;
  flex: 1;
  min-height: 0;
  overflow: hidden;
  margin: 0;
  align-items: flex-start;
}
#start-menu-left {
  flex: 0 0 60%;
  background: #fff;
  border-right: 3px solid #ddd;
  overflow-y: auto;
  overflow-x: hidden;
  box-sizing: border-box;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-self: stretch;
}
#start-menu-right {
  flex: 0 0 40%;
  background: linear-gradient(180deg, #d0e8ff 0%, #b8d8f0 100%);
  padding: 0;
  overflow-y: auto;
  overflow-x: hidden;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  align-self: stretch;
}
.start-menu-item {
  padding: 6px 10px 6px 15px;
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  transition: background 0.1s;
  border-left: 3px solid transparent;
  box-sizing: border-box;
}
.start-menu-item:hover {
  background: linear-gradient(90deg, #e8f4ff 0%, #d0e8ff 100%);
  border-left-color: #316ac5;
}
.start-menu-item-icon {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}
.start-menu-item-text {
  flex: 1;
  min-width: 0;
  overflow: hidden;
}
.start-menu-item-name {
  font-size: 11px;
  font-weight: bold;
  color: #000;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.start-menu-item-desc {
  font-size: 9px;
  color: #666;
  margin-top: 1px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.start-menu-section {
  margin-bottom: 0px;
  padding: 5px;
}
.start-menu-section-title {
  font-size: 10px;
  color: #1a4a7a;
  padding: 8px 8px 4px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid rgba(0,0,0,0.1);
  margin-bottom: 3px;
}
.start-menu-shortcut {
  padding: 5px 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  border-radius: 3px;
  transition: background 0.1s;
  margin-bottom: 2px;
  border-left: 3px solid transparent;
  box-sizing: border-box;
}
.start-menu-shortcut:hover {
  background: rgba(255,255,255,0.6);
  border-left-color: #1a5cb8;
}
.start-menu-shortcut-icon {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}
.start-menu-shortcut-text {
  font-size: 11px;
  font-weight: bold;
  color: #003;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#start-menu-footer {
  background: linear-gradient(180deg, #3a7be8 0%, #1a5cb8 100%);
  padding: 6px 10px;
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  border-top: 0;
  flex-shrink: 0;
  box-sizing: border-box;
}
.start-menu-footer-btn {
  background: linear-gradient(180deg, #ff6b4a 0%, #d44a2a 100%);
  border: 1px solid #a03820;
  border-radius: 3px;
  padding: 5px 10px;
  color: #fff;
  font-size: 11px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: all 0.2s;
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  text-shadow: 0 1px 1px rgba(0,0,0,0.3);
  white-space: nowrap;
}
.start-menu-footer-btn:hover {
  background: linear-gradient(180deg, #ff8060 0%, #e55a3a 100%);
  transform: translateY(-1px);
  box-shadow: 0 3px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
}
.start-menu-footer-btn:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3);
}
#logoff-btn {
  background: linear-gradient(180deg, #ffa040 0%, #e88020 100%);
  border-color: #c06010;
}
#logoff-btn:hover {
  background: linear-gradient(180deg, #ffb060 0%, #f09030 100%);
}
#taskbar-programs {
  flex: 1;
  display: flex;
  align-items: center;
  padding: 0 5px;
  gap: 3px;
  height: 100%;
}
.taskbar-item {
  height: 22px;
  min-width: 140px;
  max-width: 180px;
  background: linear-gradient(180deg, #3c89d0 0%, #2a6cb8 40%, #2462aa 60%, #1d58a0 100%);
  border: 1px solid;
  border-color: #4a9ee8 #1a4a8a #1a4a8a #4a9ee8;
  border-radius: 2px;
  padding: 0 8px;
  color: #fff;
  font-size: 11px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.2);
}
.taskbar-item:hover { background: linear-gradient(180deg, #4a9ee8 0%, #3a89d0 40%, #3080c8 60%, #2870b8 100%); }
.taskbar-item.active {
  background: linear-gradient(180deg, #1e5090 0%, #1a4580 40%, #164078 60%, #123870 100%);
  border-color: #1a4a8a #4a9ee8 #4a9ee8 #1a4a8a;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
}
.taskbar-item-icon { width: 16px; height: 16px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
.taskbar-item-text { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
#system-tray {
  height: 100%;
  background: linear-gradient(180deg, #1a8cde 0%, #1670c4 50%, #1060b0 100%);
  border-left: 1px solid #0d3ba8;
  padding: 0 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.tray-icon { 
  font-size: 12px; 
  opacity: 0.9; 
  cursor: pointer;
  position: relative;
}
.tray-icon:hover { opacity: 1; }
#clock { 
  color: #fff; 
  font-size: 11px; 
  text-shadow: 1px 1px 1px rgba(0,0,0,0.3); 
  font-family: 'Tahoma', sans-serif;
  cursor: pointer;
}
#volume-popup {
  position: fixed;
  bottom: 35px;
  right: 10px;
  width: 50px;
  height: 150px;
  background: var(--xp-window-bg);
  border: 1px solid #0054e3;
  border-radius: 6px;
  box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
  padding: 10px;
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  z-index: 1007;
}
#volume-slider {
  writing-mode: bt-lr;
  -webkit-appearance: slider-vertical;
  appearance: slider-vertical;
  width: 8px;
  height: 100px;
  flex: 1;
}
#notification-area {
  position: fixed;
  bottom: 40px;
  right: 10px;
  width: 300px;
  z-index: 1008;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.notification {
  background: linear-gradient(180deg, #fff 0%, #f8f6f0 100%);
  border: 1px solid #0054e3;
  border-radius: 6px;
  padding: 12px;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
  animation: notification-slide 0.3s ease-out;
  display: flex;
  gap: 10px;
  cursor: pointer;
}
@keyframes notification-slide {
  from {
    transform: translateX(320px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
.notification-icon {
  font-size: 24px;
}
.notification-content {
  flex: 1;
}
.notification-title {
  font-size: 12px;
  font-weight: bold;
  color: #003399;
  margin-bottom: 4px;
}
.notification-text {
  font-size: 11px;
  color: #333;
  line-height: 1.4;
}
.notification-close {
  font-size: 16px;
  cursor: pointer;
  opacity: 0.5;
  transition: opacity 0.1s;
}
.notification-close:hover {
  opacity: 1;
}

/* Continue dans la partie 2... *//* Suite des styles depuis la partie 1 */

.window {
  background: var(--xp-window-bg);
  border: 1px solid #0054e3;
  border-radius: 8px 8px 0 0;
  box-shadow: 0 0 0 1px #0054e3, 2px 2px 10px rgba(0,0,0,0.4), inset 0 0 0 1px rgba(255,255,255,0.1);
  width: 95%;
  max-width: 950px;
  height: 92vh;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  overflow: hidden;
  display: none;
  z-index: 1010;
}
.explorer-window {
  width: 750px;
  height: 550px;
  max-width: 750px;
  z-index: 1011;
}
.game-window {
  width: 400px;
  height: 450px;
  max-width: 400px;
  z-index: 1012;
}
.email-window {
  width: 700px;
  height: 550px;
  max-width: 700px;
  z-index: 1013;
}
.settings-window {
  width: 600px;
  height: 500px;
  max-width: 600px;
  z-index: 1014;
}
.calendar-window {
  width: 450px;
  height: 400px;
  max-width: 450px;
  z-index: 1015;
}
.title-bar {
  height: 30px;
  background: linear-gradient(180deg, #0058ee 0%, #3a93ff 8%, #2b7fff 15%, #1872eb 85%, #0855dd 92%, #0044bb 100%);
  border-radius: 6px 6px 0 0;
  padding: 0 4px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: default;
}
.title-bar-icon { width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.title-bar-text {
  flex: 1;
  color: #fff;
  font-size: 13px;
  font-weight: bold;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.title-bar-buttons { display: flex; gap: 2px; }
.title-bar-button {
  width: 21px;
  height: 21px;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  font-weight: bold;
  transition: filter 0.1s;
}
.btn-minimize { background: linear-gradient(180deg, #3dc2ff 0%, #1ca8e8 50%, #0d98d8 100%); color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.3); }
.btn-maximize { background: linear-gradient(180deg, #3dc2ff 0%, #1ca8e8 50%, #0d98d8 100%); color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.3); }
.btn-close { background: linear-gradient(180deg, #f8a882 0%, #e87751 50%, #d85538 100%); color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.3); }
.title-bar-button:hover { filter: brightness(1.2); }
.title-bar-button:active { filter: brightness(0.9); }
.window-content { height: calc(100% - 30px); overflow: auto; background: var(--xp-window-bg); border-top: 1px solid rgba(255,255,255,0.5); }
.explorer-toolbar {
  background: linear-gradient(180deg, #f5f3ee 0%, #e8e4dc 100%);
  border-bottom: 1px solid #aca899;
  padding: 5px 8px;
  display: flex;
  gap: 5px;
  align-items: center;
}
.toolbar-btn {
  background: linear-gradient(180deg, #fff 0%, #f5f4ea 45%, #dedad2 55%, #d2cec6 100%);
  border: 1px solid;
  border-color: #8e8f8f #5d6069 #5d6069 #8e8f8f;
  border-radius: 3px;
  padding: 3px 8px;
  font: 11px 'Tahoma', sans-serif;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
}
.toolbar-btn:hover { background: linear-gradient(180deg, #fff 0%, #fff7e6 45%, #f0e8d8 55%, #e8e0d0 100%); border-color: #316ac5; }
.toolbar-btn:active { background: linear-gradient(180deg, #d8d4cc 0%, #e8e4dc 100%); }
.toolbar-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.address-bar-container {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 5px;
  background: #fff;
  border: 1px solid #7f9db9;
  padding: 2px 5px;
}
.address-bar-label { font-size: 11px; color: #666; }
.address-bar {
  flex: 1;
  border: none;
  font: 11px 'Tahoma', sans-serif;
  outline: none;
}
.explorer-content {
  display: flex;
  height: calc(100% - 80px);
}
.explorer-sidebar {
  width: 180px;
  background: linear-gradient(180deg, #f5f3ee 0%, #e8e4dc 100%);
  border-right: 1px solid #aca899;
  padding: 10px;
}
.sidebar-section {
  margin-bottom: 15px;
}
.sidebar-title {
  font-size: 11px;
  font-weight: bold;
  color: #003399;
  margin-bottom: 5px;
}
.sidebar-item {
  padding: 4px 8px;
  font-size: 11px;
  cursor: pointer;
  border-radius: 2px;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background 0.1s;
}
.sidebar-item:hover {
  background: rgba(49,106,197,0.1);
}
.sidebar-item.active {
  background: #316ac5;
  color: #fff;
}
.explorer-main {
  flex: 1;
  background: #fff;
  padding: 15px;
  overflow-y: auto;
}
.file-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap: 15px;
}
.file-item {
  text-align: center;
  cursor: pointer;
  padding: 8px;
  border: 1px solid transparent;
  border-radius: 3px;
  transition: all 0.1s;
}
.file-item:hover {
  background: rgba(49,106,197,0.1);
  border-color: rgba(49,106,197,0.3);
}
.file-item.selected {
  background: rgba(49,106,197,0.2);
  border-color: #316ac5;
}
.file-icon {
  width: 48px;
  height: 48px;
  margin: 0 auto 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
}
.file-name {
  font-size: 11px;
  color: #000;
  word-wrap: break-word;
  line-height: 1.3;
}
.notepad-window {
  width: 600px;
  height: 450px;
  max-width: 600px;
  z-index: 1016;
}
.notepad-window .window-content {
  background: #fff;
  padding: 0;
}
.notepad-textarea {
  width: 100%;
  height: 100%;
  border: none;
  resize: none;
  font-family: 'Lucida Console', 'Courier New', monospace;
  font-size: 12px;
  line-height: 1.4;
  outline: none;
  padding: 8px;
}
.explorer-statusbar {
  background: var(--xp-window-bg);
  border-top: 1px solid #aca899;
  padding: 3px 8px;
  font-size: 11px;
  color: #333;
  display: flex;
  gap: 20px;
}
.game-content {
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  height: 100%;
  background: #fff;
}
.minesweeper-grid {
  display: grid;
  gap: 1px;
  background: #999;
  border: 3px solid;
  border-color: #fff #7b7b7b #7b7b7b #fff;
  padding: 3px;
}
.mine-cell {
  width: 25px;
  height: 25px;
  background: linear-gradient(135deg, #e0e0e0 0%, #c0c0c0 100%);
  border: 2px solid;
  border-color: #fff #7b7b7b #7b7b7b #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  user-select: none;
}
.mine-cell:active {
  border-color: #7b7b7b #fff #fff #7b7b7b;
}
.mine-cell.revealed {
  background: #c0c0c0;
  border: 1px solid #7b7b7b;
}
.mine-cell.flagged::after {
  content: 'üö©';
  font-size: 14px;
}
.mine-cell.mine::after {
  content: 'üí£';
  font-size: 14px;
}
.game-info {
  display: flex;
  gap: 30px;
  font-size: 13px;
  font-weight: bold;
}
.email-content {
  display: flex;
  height: 100%;
  background: #fff;
}
.email-sidebar {
  width: 200px;
  background: linear-gradient(180deg, #f5f3ee 0%, #e8e4dc 100%);
  border-right: 1px solid #aca899;
  padding: 10px;
}
.email-folder {
  padding: 8px;
  cursor: pointer;
  border-radius: 3px;
  font-size: 11px;
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 4px;
  transition: background 0.1s;
}
.email-folder:hover {
  background: rgba(49,106,197,0.1);
}
.email-folder.active {
  background: #316ac5;
  color: #fff;
}
.email-list {
  flex: 1;
  border-right: 1px solid #ddd;
  overflow-y: auto;
}
.email-item {
  padding: 12px;
  border-bottom: 1px solid #ddd;
  cursor: pointer;
  transition: background 0.1s;
}
.email-item:hover {
  background: #f0f8ff;
}
.email-item.unread {
  background: #fff8e6;
  font-weight: bold;
}
.email-item-from {
  font-size: 12px;
  font-weight: bold;
  color: #003399;
  margin-bottom: 4px;
}
.email-item-subject {
  font-size: 11px;
  color: #000;
  margin-bottom: 4px;
}
.email-item-preview {
  font-size: 10px;
  color: #666;
}
.email-preview {
  flex: 2;
  padding: 20px;
  overflow-y: auto;
}
.email-preview-header {
  border-bottom: 2px solid #ddd;
  padding-bottom: 15px;
  margin-bottom: 15px;
}
.email-preview-from {
  font-size: 13px;
  font-weight: bold;
  color: #003399;
  margin-bottom: 8px;
}
.email-preview-subject {
  font-size: 15px;
  font-weight: bold;
  margin-bottom: 8px;
}
.email-preview-date {
  font-size: 11px;
  color: #666;
}
.email-preview-body {
  font-size: 12px;
  line-height: 1.6;
  white-space: pre-wrap;
}
.settings-content {
  padding: 20px;
  background: #fff;
  height: 100%;
  overflow-y: auto;
}
.settings-section {
  margin-bottom: 25px;
  padding-bottom: 20px;
  border-bottom: 1px solid #ddd;
}
.settings-section:last-child {
  border-bottom: none;
}
.settings-title {
  font-size: 14px;
  font-weight: bold;
  color: #003399;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.settings-option {
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.settings-option-label {
  font-size: 12px;
  color: #333;
}
.settings-option-control {
  display: flex;
  gap: 10px;
  align-items: center;
}
.calendar-content {
  padding: 15px;
  background: #fff;
  height: 100%;
  display: flex;
  flex-direction: column;
}
.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 2px solid #ddd;
}
.calendar-month {
  font-size: 16px;
  font-weight: bold;
  color: #003399;
}
.calendar-nav {
  display: flex;
  gap: 10px;
}
.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
  flex: 1;
}
.calendar-day-header {
  text-align: center;
  font-size: 11px;
  font-weight: bold;
  padding: 8px;
  background: linear-gradient(180deg, #f5f3ee 0%, #e8e4dc 100%);
  color: #003399;
}
.calendar-day {
  border: 1px solid #ddd;
  padding: 8px;
  min-height: 40px;
  cursor: pointer;
  transition: background 0.1s;
  font-size: 11px;
}
.calendar-day:hover {
  background: #f0f8ff;
}
.calendar-day.today {
  background: #e6f3ff;
  border-color: #316ac5;
  font-weight: bold;
}
.calendar-day.other-month {
  color: #999;
  background: #f9f9f9;
}
.xp-button {
  background: linear-gradient(180deg, #fff 0%, #f5f4ea 45%, #dedad2 55%, #d2cec6 100%);
  border: 1px solid;
  border-color: #8e8f8f #5d6069 #5d6069 #8e8f8f;
  border-radius: 3px;
  padding: 4px 16px;
  font: 11px 'Tahoma', sans-serif;
  cursor: pointer;
  box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.1);
  color: #000;
  transition: all 0.1s;
}
.xp-button:hover { background: linear-gradient(180deg, #fff 0%, #fff7e6 45%, #f0e8d8 55%, #e8e0d0 100%); border-color: #316ac5; }
.xp-button:active { background: linear-gradient(180deg, #d8d4cc 0%, #e8e4dc 100%); border-color: #5d6069 #8e8f8f #8e8f8f #5d6069; box-shadow: inset 0 1px 2px rgba(0,0,0,0.2); }
.xp-button-primary { background: linear-gradient(180deg, #fff 0%, #e6f0ff 45%, #c0d8ff 55%, #a8c8ff 100%); border-color: #003c74; }
.xp-button-danger { background: linear-gradient(180deg, #fff 0%, #ffe6e6 45%, #ffcccc 55%, #ffb8b8 100%); border-color: #8b0000; color: #8b0000; }
.xp-input {
  background: #fff;
  border: 1px solid var(--xp-input-border);
  padding: 4px 6px;
  font: 11px 'Tahoma', sans-serif;
  width: 100%;
  box-shadow: inset 1px 1px 2px rgba(0,0,0,0.1);
}
.xp-input:focus { outline: none; border-color: #316ac5; box-shadow: inset 1px 1px 2px rgba(0,0,0,0.1), 0 0 0 1px rgba(49,106,197,0.3); }
.xp-label { font: 11px 'Tahoma', sans-serif; color: #000; margin-bottom: 3px; display: block; }
.xp-checkbox { accent-color: var(--xp-selection); }
.xp-select {
  background: #fff;
  border: 1px solid var(--xp-input-border);
  padding: 4px 6px;
  font: 11px 'Tahoma', sans-serif;
  cursor: pointer;
}
.login-view { display: flex; justify-content: center; align-items: center; height: 100%; background: linear-gradient(180deg, #e8e4dc 0%, #d8d4cc 100%); }
.login-box {
  width: 340px;
  background: linear-gradient(180deg, #fff 0%, #f8f6f0 100%);
  border: 2px solid;
  border-color: #fff #aca899 #aca899 #fff;
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  overflow: hidden;
}
.login-header {
  background: linear-gradient(180deg, #2b71e8 0%, #2063d0 100%);
  padding: 15px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.login-header-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.login-header-text { color: #fff; font-size: 16px; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
.login-body { padding: 25px; }
.login-field { margin-bottom: 15px; }
.login-field .xp-label { margin-bottom: 5px; font-weight: bold; }
.login-actions { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }
.login-error { background: #ffe6e6; border: 1px solid #cc0000; color: #cc0000; padding: 10px 12px; border-radius: 4px; font-size: 11px; margin-bottom: 15px; display: none; }
.main-header {
  background: linear-gradient(180deg, #f5f3ee 0%, #e8e4dc 100%);
  border-bottom: 1px solid #aca899;
  padding: 10px 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.main-header h1 { font-size: 18px; color: #003399; font-weight: bold; display: flex; align-items: center; gap: 8px; }
.main-header h1::before { content: 'üìã'; font-size: 20px; }
.main-toolbar { background: var(--xp-window-bg); border-bottom: 1px solid #aca899; padding: 8px 15px; display: flex; gap: 10px; align-items: center; }
.search-container { flex: 1; max-width: 400px; position: relative; }
.search-container::before { content: 'üîç'; position: absolute; left: 8px; top: 50%; transform: translateY(-50%); font-size: 12px; opacity: 0.5; }
.search-container .xp-input { padding-left: 28px; }
.main-content { padding: 15px; height: calc(100% - 95px); overflow-y: auto; background: #fff; }
#inmates-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; }
.inmate-card {
  background: linear-gradient(180deg, #fff 0%, #f8f6f0 100%);
  border: 1px solid #aca899;
  border-radius: 4px;
  padding: 12px;
  cursor: pointer;
  transition: all 0.15s;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.inmate-card:hover { background: linear-gradient(180deg, #e8f4ff 0%, #d0e8ff 100%); border-color: #316ac5; box-shadow: 0 2px 6px rgba(49,106,197,0.3); transform: translateY(-1px); }
.inmate-card-header { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; }
.inmate-avatar {
  width: 42px;
  height: 42px;
  background: linear-gradient(135deg, #667788 0%, #4a5566 100%);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: #fff;
  box-shadow: inset 0 -2px 4px rgba(0,0,0,0.2);
}
.inmate-info { flex: 1; }
.inmate-name { font-size: 13px; font-weight: bold; color: #003399; margin-bottom: 2px; }
.inmate-alias { font-size: 11px; color: #666; font-style: italic; }
.inmate-meta { display: flex; gap: 15px; font-size: 11px; color: #555; padding-top: 8px; border-top: 1px solid #e0dcd4; }
.inmate-meta-item { display: flex; align-items: center; gap: 4px; }
.inmate-meta-item::before { font-size: 10px; }
.meta-block::before { content: 'üè¢'; }
.meta-cell::before { content: 'üö™'; }
.meta-sentence::before { content: '‚è±Ô∏è'; }
.sentence-life { color: #cc0000; font-weight: bold; }
.detail-header { background: linear-gradient(180deg, #f5f3ee 0%, #e8e4dc 100%); border-bottom: 1px solid #aca899; padding: 10px 15px; }
.detail-content { padding: 20px; background: #fff; height: calc(100% - 55px); overflow-y: auto; }
.detail-card { background: linear-gradient(180deg, #fff 0%, #faf8f5 100%); border: 1px solid #aca899; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.detail-card-header { background: linear-gradient(180deg, #2b71e8 0%, #2063d0 100%); padding: 20px; display: flex; align-items: center; gap: 15px; }
.detail-avatar { width: 64px; height: 64px; background: linear-gradient(135deg, #f0f0f0 0%, #d0d0d0 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 32px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); }
.detail-title h2 { color: #fff; font-size: 20px; margin-bottom: 4px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
.detail-title p { color: rgba(255,255,255,0.8); font-size: 13px; font-style: italic; }
.detail-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: #aca899; border-bottom: 1px solid #aca899; }
.detail-grid-item { background: #f8f6f0; padding: 12px 15px; }
.detail-grid-label { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
.detail-grid-value { font-size: 13px; color: #333; font-weight: bold; }
.detail-sections { padding: 20px; }
.detail-section { margin-bottom: 20px; }
.detail-section:last-child { margin-bottom: 0; }
.detail-section-title { font-size: 12px; font-weight: bold; color: #003399; margin-bottom: 8px; padding-bottom: 5px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 6px; }
.detail-section-content { font-size: 12px; color: #333; line-height: 1.6; white-space: pre-wrap; }
.admin-notes-section { background: linear-gradient(180deg, #fff8e0 0%, #fff4cc 100%); border: 1px solid #e6b800; border-radius: 4px; padding: 15px; }
.admin-notes-section .detail-section-title { color: #996600; border-bottom-color: #e6b800; }
.detail-actions { padding: 15px 20px; background: #f0ece4; border-top: 1px solid #aca899; display: flex; gap: 10px; }
.form-content { padding: 20px; background: #fff; height: calc(100% - 55px); overflow-y: auto; }
.form-card { background: #faf8f5; border: 1px solid #aca899; border-radius: 6px; overflow: hidden; }
.form-section { padding: 20px; border-bottom: 1px solid #e0dcd4; }
.form-section:last-child { border-bottom: none; }
.form-section-title { font-size: 13px; font-weight: bold; color: #003399; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
.form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
.form-field { display: flex; flex-direction: column; }
.form-field.full-width { grid-column: 1 / -1; }
.form-field .xp-label { font-weight: bold; margin-bottom: 5px; }
.form-field .required::after { content: ' *'; color: #cc0000; }
.form-checkbox { display: flex; align-items: center; gap: 8px; padding-top: 25px; }
.form-checkbox .xp-label { margin: 0; font-weight: normal; }
.form-textarea { min-height: 80px; resize: vertical; }
.form-admin-section { background: linear-gradient(180deg, #fff8e0 0%, #fff4cc 100%); border: 1px solid #e6b800; }
.form-admin-section .form-section-title { color: #996600; }
.form-message { padding: 10px 15px; border-radius: 4px; font-size: 12px; margin-top: 15px; }
.form-error { background: #ffe6e6; border: 1px solid #cc0000; color: #cc0000; }
.form-success { background: #e6ffe6; border: 1px solid #00aa00; color: #006600; }
.form-actions { padding: 15px 20px; background: #f0ece4; display: flex; justify-content: flex-end; gap: 10px; }
#delete-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1020; }
.modal-window { width: 360px; background: var(--xp-window-bg); border-radius: 8px 8px 0 0; box-shadow: 0 8px 32px rgba(0,0,0,0.4); overflow: hidden; }
.modal-title-bar { height: 28px; background: linear-gradient(180deg, #0058ee 0%, #3a93ff 8%, #2b7fff 15%, #1872eb 85%, #0855dd 92%, #0044bb 100%); border-radius: 6px 6px 0 0; padding: 0 8px; display: flex; align-items: center; justify-content: space-between; }
.modal-title-bar span { color: #fff; font-size: 12px; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
.modal-content { padding: 25px; display: flex; gap: 15px; }
.modal-icon { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; font-size: 40px; }
.modal-text { flex: 1; }
.modal-text h3 { font-size: 13px; color: #000; margin-bottom: 10px; }
.modal-text p { font-size: 12px; color: #333; line-height: 1.5; }
.modal-actions { padding: 15px 25px; background: #f0ece4; display: flex; justify-content: flex-end; gap: 10px; }
#no-results { text-align: center; padding: 60px 20px; color: #666; }
#no-results::before { content: 'üîç'; display: block; font-size: 48px; margin-bottom: 15px; opacity: 0.4; }
.hidden { display: none !important; }
.blurred { filter: blur(5px); user-select: none; pointer-events: none; }
.user-badge { background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%); color: white; padding: 3px 10px; border-radius: 10px; font-size: 10px; font-weight: bold; text-transform: uppercase; margin-left: 10px; }
.user-badge.admin-badge { background: linear-gradient(180deg, #f44336 0%, #c62828 100%); }
::-webkit-scrollbar { width: 17px; height: 17px; }
::-webkit-scrollbar-track { background: #f0f0f0; border: 1px solid #d0d0d0; }
::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #fff 0%, #e8e8e8 40%, #d0d0d0 60%, #c0c0c0 100%); border: 1px solid #808080; }
::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #fff 0%, #f0f0f0 40%, #e0e0e0 60%, #d0d0d0 100%); }
::-webkit-scrollbar-button { background: linear-gradient(180deg, #fff 0%, #e8e8e8 40%, #d0d0d0 60%, #c0c0c0 100%); border: 1px solid #808080; height: 17px; width: 17px; }
::-webkit-scrollbar-corner { background: #f0f0f0; }

/* Calculatrice */
.calc-btn {
  padding: 10px;
  font-size: 14px;
  font-weight: bold;
  border: 2px outset #ddd;
  background: linear-gradient(180deg, #f5f5f5 0%, #e0e0e0 100%);
  cursor: pointer;
  transition: all 0.1s;
}
.calc-btn:hover { background: linear-gradient(180deg, #fff 0%, #f0f0f0 100%); }
.calc-btn:active { border-style: inset; background: #d0d0d0; }
.calc-op { background: linear-gradient(180deg, #e8f0ff 0%, #d0e0f0 100%); color: #0066cc; }
.calc-eq { background: linear-gradient(180deg, #0066cc 0%, #004499 100%); color: #fff; }
.calc-eq:hover { background: linear-gradient(180deg, #0077dd 0%, #0055aa 100%); }

/* Panneau de configuration */
.cp-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 15px 10px;
  border: 1px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  text-align: center;
  font-size: 11px;
  color: #333;
  transition: all 0.2s;
}
.cp-item:hover {
  background: #e8f4ff;
  border-color: #0066cc;
}

/* Aide et support */
.help-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 15px;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 13px;
  color: #333;
}
.help-item:hover {
  background: #e8f4ff;
  border-color: #0066cc;
  color: #0066cc;
}

/* Lecteur media et CCTV */
.media-player-body {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px;
  height: 100%;
  background: #f7f7f7;
}
.media-iframe {
  width: 100%;
  flex: 1;
  border: 1px solid #aaa;
  border-radius: 4px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
}
.media-info {
  font-size: 12px;
  color: #333;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 8px 10px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
}

.cctv-wrapper {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  height: 100%;
  background: #f4f7fb;
}
.cctv-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  background: linear-gradient(180deg,#e8f1ff 0%,#d4e4ff 100%);
  border: 1px solid #99b8e8;
  border-radius: 4px;
  padding: 8px 10px;
  font-size: 12px;
  color: #1a3f7a;
}
.cctv-grid {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 10px;
}
.cctv-card {
  background: #0c0f1a;
  color: #b8c7ff;
  border: 1px solid #1e2a44;
  border-radius: 4px;
  overflow: hidden;
  position: relative;
  min-height: 140px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.cctv-card::after {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(0deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 1px, transparent 2px, transparent 3px);
  pointer-events: none;
}
.cctv-thumb {
  position: absolute;
  inset: 0;
  object-fit: cover;
  width: 100%;
  height: 100%;
  filter: brightness(0.55);
  z-index: 1;
}
.cctv-title { position: relative; z-index: 3; }
.cctv-video {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
  display: block;
}
.cctv-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 8px;
  background: rgba(20,30,60,0.8);
  border-bottom: 1px solid #24304e;
  font-size: 11px;
  letter-spacing: 0.3px;
}
.cctv-feed {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
  gap: 6px;
  font-size: 12px;
  color: #9bc4ff;
}
.cctv-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  background: #000;
  border-top: 1px solid #1e2a44;
}
.cctv-status {
  font-size: 11px;
  color: #5ad26d;
  font-weight: bold;
}
.cctv-alert { color: #ff6b6b; }
.cctv-btn {
  border: 1px solid #99b8e8;
  background: linear-gradient(180deg,#e8f1ff 0%,#c9dcff 100%);
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 11px;
  cursor: pointer;
}
.cctv-btn:active { filter: brightness(0.95); }

/* Menu contextuel */
#context-menu {
  position: fixed;
  background: #f7f7f7;
  border: 1px solid #9eb4d5;
  box-shadow: 2px 2px 8px rgba(0,0,0,0.25);
  border-radius: 4px;
  min-width: 180px;
  z-index: 2000;
  font-family: 'Tahoma', sans-serif;
  padding: 4px 0;
}
.context-menu-item {
  padding: 6px 14px;
  font-size: 12px;
  color: #000;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
}
.context-menu-item:hover {
  background: #e0ecff;
  color: #1a4fb5;
}
.context-menu-separator {
  height: 1px;
  margin: 4px 0;
  background: #d0d7e5;
}
</style>
</head>
<body>

<!-- Continue dans la partie 3 avec tout le HTML et JavaScript... --><!-- Suite du HTML depuis la partie 2 -->

<div id="bios">
  <div id="bios-header">PHOENIX - AWARD BIOS CMOS SETUP UTILITY</div>
  <div id="bios-content">
    <svg class="windows-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width:80px;height:80px;margin-bottom:25px;filter:drop-shadow(0 0 15px rgba(0,153,255,0.6));">
      <rect x="8" y="8" width="35" height="35" fill="#0099ff" stroke="#00ccff" stroke-width="1.5" rx="2"/>
      <rect x="47" y="8" width="35" height="35" fill="#00cc00" stroke="#33ff33" stroke-width="1.5" rx="2"/>
      <rect x="8" y="47" width="35" height="35" fill="#ff6600" stroke="#ff8833" stroke-width="1.5" rx="2"/>
      <rect x="47" y="47" width="35" height="35" fill="#ee0000" stroke="#ff3333" stroke-width="1.5" rx="2"/>
    </svg>
    <div id="bios-text"></div>
  </div>
  <div id="bios-prompt">Appuyez sur une touche pour continuer...</div>
  <div id="bios-footer">
    <span>F2: Setup | F12: Boot Menu | DEL: BIOS</span>
    <span>v4.2.1 ¬© 2025 Brolingboke Systems Inc.</span>
  </div>
</div>

<div id="boot">
  <div id="boot-content">
    <svg class="windows-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width:140px;height:140px;filter:drop-shadow(0 0 30px rgba(0,153,255,0.8));animation:boot-logo-shine 2s ease-in-out infinite;">
      <rect x="8" y="8" width="35" height="35" fill="#0099ff" stroke="#00ddff" stroke-width="2" rx="3"/>
      <rect x="47" y="8" width="35" height="35" fill="#00cc00" stroke="#55ff55" stroke-width="2" rx="3"/>
      <rect x="8" y="47" width="35" height="35" fill="#ff6600" stroke="#ffaa44" stroke-width="2" rx="3"/>
      <rect x="47" y="47" width="35" height="35" fill="#ee0000" stroke="#ff5555" stroke-width="2" rx="3"/>
    </svg>
    <style>
      @keyframes boot-logo-shine {
        0%, 100% { filter: drop-shadow(0 0 20px rgba(0,153,255,0.6)); transform: scale(1); }
        50% { filter: drop-shadow(0 0 40px rgba(0,200,255,0.9)); transform: scale(1.02); }
      }
    </style>
    <div id="boot-text">GrandLine XP</div>
    <div id="boot-subtext">Professionnel</div>
  </div>
  <div id="boot-bottom">
    <div id="boot-dots"><span></span><span></span><span></span></div>
    <div id="boot-copyright">GrandLine XP ‚Ä¢ Brolingboke Systems</div>
  </div>
</div>

<div id="startup">
  <div id="startup-logo-container">
    <svg class="windows-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width:120px;height:120px;filter:drop-shadow(0 0 25px rgba(0,153,255,0.7));animation:startup-logo-glow 2s ease-in-out infinite;">
      <rect x="8" y="8" width="35" height="35" fill="#0099ff" stroke="#00ddff" stroke-width="2" rx="3"/>
      <rect x="47" y="8" width="35" height="35" fill="#00cc00" stroke="#55ff55" stroke-width="2" rx="3"/>
      <rect x="8" y="47" width="35" height="35" fill="#ff6600" stroke="#ffaa44" stroke-width="2" rx="3"/>
      <rect x="47" y="47" width="35" height="35" fill="#ee0000" stroke="#ff5555" stroke-width="2" rx="3"/>
    </svg>
    <style>
      @keyframes startup-logo-glow {
        0%, 100% { filter: drop-shadow(0 0 15px rgba(0,153,255,0.5)); }
        50% { filter: drop-shadow(0 0 35px rgba(0,200,255,0.8)); }
      }
    </style>
    <div id="startup-logo"><span>GrandLine</span> XP</div>
  </div>
  <div id="startup-bar-container">
    <div id="startup-bar"><div id="startup-progress"></div></div>
  </div>
  <div id="startup-text">Chargement des param√®tres personnels...</div>
  <div id="startup-copyright">GrandLine XP ‚Ä¢ Brolingboke Systems</div>
</div>

<!-- √âcran de s√©lection de profil -->
<div id="login-screen" style="display:none; position:fixed; inset:0; background:linear-gradient(135deg,#0a2d5a 0%,#1a5cb8 50%,#0d3f7f 100%); z-index:1000; display:none; flex-direction:column; align-items:center; justify-content:center; font-family:'Tahoma',sans-serif;">
  <style>
    #login-screen { overflow:hidden; }
    #login-screen::before { content:''; position:absolute; inset:0; background:radial-gradient(ellipse at 60% 40%, rgba(0,255,200,0.15) 0%, transparent 70%); pointer-events:none; }
    .login-wrapper { position:relative; z-index:1; }
    .login-container { background:linear-gradient(180deg,#f5f5f5 0%,#e8e8e8 100%); border:3px solid #0055dd; border-radius:16px; box-shadow:0 24px 64px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.8); width:520px; padding:0; overflow:hidden; }
    .login-header { background:linear-gradient(180deg,#0055dd 0%,#003d7a 100%); color:#fff; padding:28px 20px; text-align:center; font-size:20px; font-weight:bold; text-shadow:1px 1px 3px rgba(0,0,0,0.6); border-bottom:3px solid #002254; }
    .login-header svg { max-width:80px; margin-bottom:15px; filter:drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
    .login-content { padding:50px 40px; text-align:center; background:linear-gradient(180deg,#ffffff 0%,#f5f5f5 100%); }
    .login-message { color:#333; font-size:15px; margin-bottom:35px; font-weight:bold; text-shadow:0 1px 1px rgba(255,255,255,0.8); letter-spacing:0.5px; }
    .profile-item { background:linear-gradient(180deg,#fff 0%,#f8f8f8 100%); border:2px solid #aaa; border-radius:12px; padding:32px 24px; margin-bottom:20px; cursor:pointer; transition:all 0.3s ease; box-shadow:0 6px 12px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.9); }
    .profile-item:hover { background:linear-gradient(180deg,#e3f2fd 0%,#bbdefb 100%); border-color:#0055dd; box-shadow:0 12px 24px rgba(0,85,221,0.4), inset 0 1px 0 rgba(255,255,255,0.9); transform:translateY(-3px); }
    .profile-item:active { transform:translateY(-1px); box-shadow:0 4px 8px rgba(0,0,0,0.2), inset 0 1px 3px rgba(0,0,0,0.1); }
    .profile-avatar { font-size:56px; margin-bottom:14px; animation:profile-bounce 2s ease-in-out infinite; }
    @keyframes profile-bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    .profile-name { font-weight:bold; color:#000; margin-bottom:8px; font-size:15px; letter-spacing:0.3px; }
    .profile-status { font-size:13px; color:#666; font-weight:500; }
  </style>
  <div class="login-wrapper">
    <div class="login-container">
      <div class="login-header">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <defs><filter id="glow"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>
          <circle cx="50" cy="50" r="45" fill="none" stroke="#fff" stroke-width="3" filter="url(#glow)"/>
          <path d="M50,10 A40,40 0 0,1 80,70 A40,40 0 0,1 20,70" fill="#ffeb3b" stroke="none" filter="url(#glow)"/>
          <circle cx="40" cy="40" r="4" fill="#fff"/>
          <circle cx="60" cy="40" r="4" fill="#fff"/>
        </svg>
        GrandLine XP Professionnel
      </div>
      <div class="login-content">
        <div class="login-message">S√©lectionnez votre profil utilisateur</div>
        <div class="profile-item" id="profile-warden">
          <div class="profile-avatar">üëÆ</div>
          <div class="profile-name">Agent de la prison</div>
          <div class="profile-status">Acc√®s s√©curis√©</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="desktop">
  <div id="desktop-wallpaper"></div>
  <div id="desktop-icons">
    <div class="desktop-icon computer-icon" id="computer-icon">
      <div class="desktop-icon-img">üíª</div>
      <div class="desktop-icon-label">Poste de<br>travail</div>
    </div>
    <div class="desktop-icon" id="doc-icon">
      <div class="desktop-icon-img">üèõÔ∏è</div>
      <div class="desktop-icon-label">Brolingboke<br>D.O.C.</div>
    </div>
    <div class="desktop-icon folder-icon" id="documents-icon">
      <div class="desktop-icon-img">üìÅ</div>
      <div class="desktop-icon-label">Mes<br>documents</div>
    </div>
    <div class="desktop-icon email-icon" id="email-icon">
      <div class="desktop-icon-img">üìß</div>
      <div class="desktop-icon-label">Courrier<br>√©lectronique</div>
    </div>
    <div class="desktop-icon recycle-icon" id="recycle-icon">
      <div class="desktop-icon-img">üóëÔ∏è</div>
      <div class="desktop-icon-label">Corbeille</div>
    </div>
        <div class="desktop-icon txt-icon" data-file="notes_reunion.txt">
      <div class="desktop-icon-img">üìÑ</div>
      <div class="desktop-icon-label">notes_reunion.txt</div>
    </div>
    <div class="desktop-icon txt-icon" data-file="planning_semaine.txt">
      <div class="desktop-icon-img">üìÑ</div>
      <div class="desktop-icon-label">planning_semaine.txt</div>
    </div>
    <div class="desktop-icon txt-icon" data-file="contacts_urgence.txt">
      <div class="desktop-icon-img">üìÑ</div>
      <div class="desktop-icon-label">contacts_urgence.txt</div>
    </div>
    <div class="desktop-icon pdf-icon" data-file="reglement_interne.pdf">
      <div class="desktop-icon-img">üìï</div>
      <div class="desktop-icon-label">reglement_interne.pdf</div>
    </div>
    <div class="desktop-icon txt-icon" data-file="memo_direction.txt">
      <div class="desktop-icon-img">üìÑ</div>
      <div class="desktop-icon-label">memo_direction.txt</div>
    </div>
    <div class="desktop-icon shortcut-icon" data-file="rapport_mensuel">
      <div class="desktop-icon-img">üìä</div>
      <div class="desktop-icon-label">Rapport<br>mensuel</div>
    </div>
    <div class="desktop-icon" id="population-icon">
      <div class="desktop-icon-img">üìà</div>
      <div class="desktop-icon-label">Statistiques<br>Population</div>
    </div>
    <div class="desktop-icon game-icon" id="minesweeper-icon">
      <div class="desktop-icon-img">üí£</div>
      <div class="desktop-icon-label">D√©mineur</div>
    </div>
    <div class="desktop-icon shortcut-icon" id="internet-icon">
      <div class="desktop-icon-img">üåê</div>
      <div class="desktop-icon-label">Internet<br>Explorer</div>
    </div>
    <div class="desktop-icon shortcut-icon" id="notepad-icon">
      <div class="desktop-icon-img">üìù</div>
      <div class="desktop-icon-label">Bloc-notes</div>
    </div>
    <div class="desktop-icon shortcut-icon" id="calculator-icon">
      <div class="desktop-icon-img">üî¢</div>
      <div class="desktop-icon-label">Calculatrice</div>
    </div>
    <div class="desktop-icon shortcut-icon" id="control-panel-icon">
      <div class="desktop-icon-img">üéõÔ∏è</div>
      <div class="desktop-icon-label">Panneau de<br>configuration</div>
    </div>
    <div class="desktop-icon shortcut-icon" id="help-icon">
      <div class="desktop-icon-img">‚ùì</div>
      <div class="desktop-icon-label">Aide et<br>support</div>
    </div>
    <div class="desktop-icon shortcut-icon" id="media-player-icon">
      <div class="desktop-icon-img">üéµ</div>
      <div class="desktop-icon-label">Lecteur<br>Windows Media</div>
    </div>
    <div class="desktop-icon shortcut-icon" id="cctv-icon">
      <div class="desktop-icon-img">üìπ</div>
      <div class="desktop-icon-label">Surveillance<br>CCTV</div>
    </div>
  </div>
</div>

<!-- Menu clic droit -->
<div id="context-menu" style="display:none;">
  <div class="context-menu-item" id="ctx-refresh">üîÑ Actualiser</div>
  <div class="context-menu-separator"></div>
  <div class="context-menu-item" id="ctx-new-folder">üìÅ Nouveau dossier</div>
  <div class="context-menu-item" id="ctx-new-file">üìÑ Nouveau fichier texte</div>
  <div class="context-menu-separator"></div>
  <div class="context-menu-item" id="ctx-paste">üìã Coller</div>
  <div class="context-menu-separator"></div>
  <div class="context-menu-item" id="ctx-display">üñ•Ô∏è Propri√©t√©s d'affichage</div>
  <div class="context-menu-item" id="ctx-properties">‚öôÔ∏è Propri√©t√©s</div>
</div>

<div id="taskbar">
  <button id="start-btn"><span class="start-orb">‚äû</span>d√©marrer</button>
  <div id="taskbar-programs"></div>
  <div id="system-tray">
    <span class="tray-icon" id="volume-icon">üîä</span>
    <span class="tray-icon">üõ°Ô∏è</span>
    <span id="clock"></span>
  </div>
</div>

<!-- Menu d√©marrer -->
<div id="start-menu">
  <div id="start-menu-header">
    <div id="start-menu-avatar">üë§</div>
    <div id="start-menu-user">
      <div id="start-menu-user-name">Utilisateur</div>
      <div id="start-menu-user-role">Agent Brolingboke D.O.C.</div>
    </div>
  </div>
  <div id="start-menu-content">
    <div id="start-menu-left">
      <div class="start-menu-item" data-app="doc">
        <div class="start-menu-item-icon">üèõÔ∏è</div>
        <div class="start-menu-item-text">
          <div class="start-menu-item-name">Brolingboke D.O.C.</div>
          <div class="start-menu-item-desc">Base de donn√©es des d√©tenus</div>
        </div>
      </div>
      <div class="start-menu-item" data-app="email">
        <div class="start-menu-item-icon">üìß</div>
        <div class="start-menu-item-text">
          <div class="start-menu-item-name">Courrier √©lectronique</div>
          <div class="start-menu-item-desc">Messagerie interne</div>
        </div>
      </div>
      <div class="start-menu-item" data-app="explorer">
        <div class="start-menu-item-icon">üìÅ</div>
        <div class="start-menu-item-text">
          <div class="start-menu-item-name">Explorateur de fichiers</div>
          <div class="start-menu-item-desc">Parcourir vos documents</div>
        </div>
      </div>
      <div class="start-menu-item" data-app="calendar">
        <div class="start-menu-item-icon">üìÖ</div>
        <div class="start-menu-item-text">
          <div class="start-menu-item-name">Calendrier</div>
          <div class="start-menu-item-desc">Planifier vos t√¢ches</div>
        </div>
      </div>
      <div class="start-menu-item" data-app="minesweeper">
        <div class="start-menu-item-icon">üí£</div>
        <div class="start-menu-item-text">
          <div class="start-menu-item-name">D√©mineur</div>
          <div class="start-menu-item-desc">Jeu de r√©flexion</div>
        </div>
      </div>
      <div class="start-menu-item" data-app="settings">
        <div class="start-menu-item-icon">‚öôÔ∏è</div>
        <div class="start-menu-item-text">
          <div class="start-menu-item-name">Param√®tres</div>
          <div class="start-menu-item-desc">Configuration syst√®me</div>
        </div>
      </div>
    </div>
    <div id="start-menu-right">
      <div class="start-menu-section">
        <div class="start-menu-section-title">Favoris</div>
        <div class="start-menu-shortcut" data-path="documents">
          <div class="start-menu-shortcut-icon">üìÅ</div>
          <div class="start-menu-shortcut-text">Mes documents</div>
        </div>
        <div class="start-menu-shortcut" data-path="desktop">
          <div class="start-menu-shortcut-icon">üñ•Ô∏è</div>
          <div class="start-menu-shortcut-text">Bureau</div>
        </div>
        <div class="start-menu-shortcut" data-path="computer">
          <div class="start-menu-shortcut-icon">üíª</div>
          <div class="start-menu-shortcut-text">Poste de travail</div>
        </div>
      </div>
    </div>
  </div>
  <div id="start-menu-footer">
    <button class="start-menu-footer-btn" id="logoff-btn">
      <span>üëã</span> Fermer la session
    </button>
    <button class="start-menu-footer-btn" id="shutdown-btn">
      <span>‚èª</span> √âteindre
    </button>
  </div>
</div>

<!-- Popup volume -->
<div id="volume-popup">
  <div style="font-size: 20px; margin-bottom: 5px;">üîä</div>
  <input type="range" id="volume-slider" min="0" max="100" value="50" orient="vertical">
  <div style="font-size: 10px; margin-top: 5px;">50%</div>
</div>

<!-- Zone de notifications -->
<div id="notification-area"></div>

<!-- Explorateur de fichiers -->
<div class="window explorer-window" id="explorer-window">
  <div class="title-bar">
    <span class="title-bar-icon">üìÅ</span>
    <span class="title-bar-text" id="explorer-title">Mes documents</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="explorer-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content">
    <div class="explorer-toolbar">
      <button class="toolbar-btn" id="back-btn" disabled>‚óÄ Retour</button>
      <button class="toolbar-btn" id="up-btn">‚ñ≤</button>
      <button class="toolbar-btn" id="refresh-btn">üîÑ</button>
      <div class="address-bar-container">
        <span class="address-bar-label">Adresse</span>
        <input type="text" class="address-bar" id="address-bar" readonly>
      </div>
    </div>
    <div class="explorer-content">
      <div class="explorer-sidebar">
        <div class="sidebar-section">
          <div class="sidebar-title">Dossiers</div>
          <div class="sidebar-item" data-path="desktop">üñ•Ô∏è Bureau</div>
          <div class="sidebar-item active" data-path="documents">üìÅ Mes documents</div>
          <div class="sidebar-item" data-path="computer">üíª Poste de travail</div>
        </div>
      </div>
      <div class="explorer-main" id="explorer-main"></div>
    </div>
    <div class="explorer-statusbar">
      <span id="file-count">0 objets</span>
    </div>
  </div>
</div>

<!-- Bloc-notes -->
<div class="window notepad-window" id="notepad-window">
  <div class="title-bar">
    <span class="title-bar-icon">üìù</span>
    <span class="title-bar-text" id="notepad-title">Sans titre - Bloc-notes</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="notepad-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content">
    <textarea class="notepad-textarea" id="notepad-content" readonly></textarea>
  </div>
</div>

<!-- D√©mineur -->
<div class="window game-window" id="minesweeper-window">
  <div class="title-bar">
    <span class="title-bar-icon">üí£</span>
    <span class="title-bar-text">D√©mineur</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="minesweeper-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content">
    <div class="game-content">
      <div class="game-info">
        <div>üí£ Mines: <span id="mines-count">10</span></div>
        <div>‚è±Ô∏è Temps: <span id="game-time">0</span>s</div>
      </div>
      <div id="minesweeper-grid" class="minesweeper-grid"></div>
      <button class="xp-button xp-button-primary" id="new-game-btn">üéÆ Nouvelle partie</button>
    </div>
  </div>
</div>

<!-- Calculatrice -->
<div class="window" id="calculator-window" style="display:none; width:240px; z-index:1015;">
  <div class="title-bar">
    <span class="title-bar-icon">üî¢</span>
    <span class="title-bar-text">Calculatrice</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="calculator-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content" style="padding:10px; background:#ece9d8;">
    <input type="text" id="calc-display" readonly style="width:100%; height:32px; font-size:18px; text-align:right; margin-bottom:10px; border:2px inset #888; padding:0 8px; font-family:monospace;">
    <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:4px;">
      <button class="calc-btn" onclick="calcClear()">C</button>
      <button class="calc-btn" onclick="calcBackspace()">‚å´</button>
      <button class="calc-btn" onclick="calcInput('%')">%</button>
      <button class="calc-btn calc-op" onclick="calcInput('/')">/</button>
      <button class="calc-btn" onclick="calcInput('7')">7</button>
      <button class="calc-btn" onclick="calcInput('8')">8</button>
      <button class="calc-btn" onclick="calcInput('9')">9</button>
      <button class="calc-btn calc-op" onclick="calcInput('*')">√ó</button>
      <button class="calc-btn" onclick="calcInput('4')">4</button>
      <button class="calc-btn" onclick="calcInput('5')">5</button>
      <button class="calc-btn" onclick="calcInput('6')">6</button>
      <button class="calc-btn calc-op" onclick="calcInput('-')">-</button>
      <button class="calc-btn" onclick="calcInput('1')">1</button>
      <button class="calc-btn" onclick="calcInput('2')">2</button>
      <button class="calc-btn" onclick="calcInput('3')">3</button>
      <button class="calc-btn calc-op" onclick="calcInput('+')">+</button>
      <button class="calc-btn" onclick="calcInput('0')" style="grid-column:span 2;">0</button>
      <button class="calc-btn" onclick="calcInput('.')">.</button>
      <button class="calc-btn calc-eq" onclick="calcEquals()">=</button>
    </div>
  </div>
</div>

<!-- Internet Explorer - Acc√®s S√©curis√© -->
<div class="window" id="internet-window" style="display:none; width:600px; height:450px; z-index:1015;">
  <div class="title-bar">
    <span class="title-bar-icon">üåê</span>
    <span class="title-bar-text">Internet Explorer - Acc√®s refus√©</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="internet-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content" style="background:#fff;">
    <div style="background:linear-gradient(180deg,#e8f0ff,#d0e0f0); padding:8px 12px; border-bottom:1px solid #aaa;">
      <div style="display:flex; gap:8px; align-items:center;">
        <span style="color:#666;">Adresse:</span>
        <input type="text" value="http://www.brolingboke.gov" readonly style="flex:1; padding:4px 8px; border:1px solid #7f9db9;">
        <button class="xp-button" disabled>Aller</button>
      </div>
    </div>
    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:calc(100% - 50px); text-align:center; padding:40px;">
      <div style="font-size:80px; margin-bottom:20px;">üîí</div>
      <h2 style="color:#cc0000; margin-bottom:15px;">Acc√®s Internet Restreint</h2>
      <p style="color:#333; max-width:400px; line-height:1.6; margin-bottom:20px;">
        L'acc√®s √† Internet est <strong>d√©sactiv√©</strong> sur ce poste de travail pour des raisons de s√©curit√©.
      </p>
      <div style="background:#fff8dc; border:1px solid #daa520; padding:15px 20px; border-radius:4px; max-width:400px;">
        <p style="font-size:12px; color:#666; margin:0;">
          <strong>üõ°Ô∏è Politique de s√©curit√© Brolingboke D.O.C.</strong><br><br>
          Seul le r√©seau interne est accessible depuis ce terminal. Pour toute demande d'acc√®s externe, veuillez contacter le service informatique.
        </p>
      </div>
      <p style="font-size:11px; color:#999; margin-top:20px;">Code erreur: SEC_POLICY_403</p>
    </div>
  </div>
</div>

<!-- Panneau de configuration -->
<div class="window" id="control-panel-window" style="display:none; width:550px; height:400px; z-index:1015;">
  <div class="title-bar">
    <span class="title-bar-icon">üéõÔ∏è</span>
    <span class="title-bar-text">Panneau de configuration</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="control-panel-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content" style="background:#fff; padding:20px;">
    <h3 style="margin-bottom:20px; color:#0066cc; border-bottom:1px solid #ddd; padding-bottom:10px;">‚öôÔ∏è Choisissez une cat√©gorie</h3>
    <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:15px;">
      <div class="cp-item" onclick="showCPMessage('Apparence')">
        <div style="font-size:36px;">üé®</div>
        <div>Apparence et th√®mes</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('R√©seau')">
        <div style="font-size:36px;">üåê</div>
        <div>Connexions r√©seau</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('Utilisateurs')">
        <div style="font-size:36px;">üë•</div>
        <div>Comptes d\'utilisateurs</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('S√©curit√©')">
        <div style="font-size:36px;">üõ°Ô∏è</div>
        <div>Centre de s√©curit√©</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('Imprimantes')">
        <div style="font-size:36px;">üñ®Ô∏è</div>
        <div>Imprimantes et t√©l√©copieurs</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('Date')">
        <div style="font-size:36px;">üìÖ</div>
        <div>Date et heure</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('Son')">
        <div style="font-size:36px;">üîä</div>
        <div>Sons et p√©riph√©riques</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('Syst√®me')">
        <div style="font-size:36px;">üíª</div>
        <div>Syst√®me</div>
      </div>
      <div class="cp-item" onclick="showCPMessage('Ajout')">
        <div style="font-size:36px;">üì¶</div>
        <div>Ajout/Suppression de programmes</div>
      </div>
    </div>
  </div>
</div>

<!-- Aide et support -->
<div class="window" id="help-window" style="display:none; width:600px; height:450px; z-index:1015;">
  <div class="title-bar">
    <span class="title-bar-icon">‚ùì</span>
    <span class="title-bar-text">Centre d'aide et de support</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="help-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content" style="background:#fff;">
    <div style="background:linear-gradient(180deg,#2a5298,#1e3c72); padding:20px; color:#fff; text-align:center;">
      <h2 style="margin:0;">Centre d'aide et de support</h2>
      <p style="margin:10px 0 0 0; font-size:12px; opacity:0.8;">GrandLine XP Professionnel - Brolingboke D.O.C.</p>
    </div>
    <div style="padding:25px;">
      <h3 style="color:#0066cc; margin-bottom:15px;">üìö Rubriques d'aide</h3>
      <div style="display:flex; flex-direction:column; gap:12px;">
        <div class="help-item" onclick="showHelpTopic('D√©marrage')">
          <span style="font-size:20px;">üöÄ</span>
          <span>Nouveaut√©s de GrandLine XP</span>
        </div>
        <div class="help-item" onclick="showHelpTopic('S√©curit√©')">
          <span style="font-size:20px;">üîê</span>
          <span>S√©curit√© et maintenance</span>
        </div>
        <div class="help-item" onclick="showHelpTopic('R√©seau')">
          <span style="font-size:20px;">üåê</span>
          <span>Mise en r√©seau</span>
        </div>
        <div class="help-item" onclick="showHelpTopic('Bureau')">
          <span style="font-size:20px;">üñ•Ô∏è</span>
          <span>Personnaliser votre ordinateur</span>
        </div>
        <div class="help-item" onclick="showHelpTopic('D√©pannage')">
          <span style="font-size:20px;">üîß</span>
          <span>R√©solution des probl√®mes</span>
        </div>
      </div>
      <div style="margin-top:25px; padding:15px; background:#f5f5f5; border-radius:4px;">
        <p style="font-size:12px; color:#666; margin:0;">
          <strong>üìû Assistance technique:</strong> Contactez le service informatique au poste 2255 pour toute question.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Lecteur Media -->
<div class="window" id="media-window" style="display:none; width:520px; height:340px; z-index:1016;">
  <div class="title-bar">
    <span class="title-bar-icon">üéµ</span>
    <span class="title-bar-text">Lecteur Windows Media</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="media-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content" style="height:100%;">
    <div class="media-player-body">
      <div class="media-info">üéß Lecture locale: Never Gonna Give You Up (Rick Astley)</div>
      <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; background:#fff; border:1px solid #ccc; border-radius:6px; padding:10px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);">
        <div style="display:flex; align-items:center; gap:10px;">
          <div style="width:56px; height:56px; background:linear-gradient(135deg,#0066cc,#00a6ff); border-radius:8px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:22px;">üéµ</div>
          <div style="line-height:1.3; font-size:12px;">
            <div style="font-weight:bold; color:#003366;">Never Gonna Give You Up</div>
            <div style="color:#555;">Rick Astley ¬∑ Lecture locale</div>
            <div id="media-status" style="color:#1a7a1a; font-weight:bold; font-size:11px;">Lecture...</div>
          </div>
        </div>
        <button id="media-play-btn" class="xp-button xp-button-primary" style="min-width:90px;">‚ñ∂ Relancer</button>
      </div>
      <audio id="media-audio" preload="auto"></audio>
      <div class="media-info" style="display:flex; justify-content:space-between; align-items:center;">
        <span>Mode d√©mo - flux audio direct (sans YouTube)</span>
        <span style="color:#0066cc; font-weight:bold;">Brolingboke D.O.C.</span>
      </div>
    </div>
  </div>
</div>

<!-- CCTV Surveillance -->
<div class="window" id="cctv-window" style="display:none; width:780px; height:480px; z-index:1017;">
  <div class="title-bar">
    <span class="title-bar-icon">üìπ</span>
    <span class="title-bar-text">Surveillance CCTV - Brolingboke</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="cctv-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content" style="height:100%;">
    <div class="cctv-wrapper">
      <div class="cctv-header">
        <span>Cam√©ras principales des blocs</span>
        <div style="display:flex; gap:6px;">
          <button class="cctv-btn" id="cctv-refresh-btn">Actualiser</button>
          <button class="cctv-btn" id="cctv-lockdown-btn">Basculer veille</button>
        </div>
      </div>
      <div class="cctv-grid" id="cctv-grid">
        <div class="cctv-card">
          <div class="cctv-title">Bloc A <span class="cctv-status">En ligne</span></div>
          <img class="cctv-thumb" src="https://images.unsplash.com/photo-1528458965990-428de4b1cbf4?auto=format&fit=crop&w=800&q=50" alt="Cam A" loading="lazy">
          <video class="cctv-video" poster="https://images.unsplash.com/photo-1528458965990-428de4b1cbf4?auto=format&fit=crop&w=800&q=50" data-src="https://samplelib.com/lib/preview/mp4/sample-5s.mp4" autoplay loop muted playsinline></video>
        </div>
        <div class="cctv-card">
          <div class="cctv-title">Bloc B <span class="cctv-status cctv-alert">D√©tection mouvement</span></div>
          <img class="cctv-thumb" src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=50" alt="Cam B" loading="lazy">
          <video class="cctv-video" poster="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=50" data-src="https://samplelib.com/lib/preview/mp4/sample-10s.mp4" autoplay loop muted playsinline></video>
        </div>
        <div class="cctv-card">
          <div class="cctv-title">Bloc C <span class="cctv-status">En ligne</span></div>
          <img class="cctv-thumb" src="https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=800&q=50" alt="Cam C" loading="lazy">
          <video class="cctv-video" poster="https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=800&q=50" data-src="https://samplelib.com/lib/preview/mp4/sample-7s.mp4" autoplay loop muted playsinline></video>
        </div>
        <div class="cctv-card">
          <div class="cctv-title">Bloc D <span class="cctv-status">En ligne</span></div>
          <img class="cctv-thumb" src="https://images.unsplash.com/photo-1526413232644-8a5e2c04b7f5?auto=format&fit=crop&w=800&q=50" alt="Cam D" loading="lazy">
          <video class="cctv-video" poster="https://images.unsplash.com/photo-1526413232644-8a5e2c04b7f5?auto=format&fit=crop&w=800&q=50" data-src="https://samplelib.com/lib/preview/mp4/sample-12s.mp4" autoplay loop muted playsinline></video>
        </div>
        <div class="cctv-card">
          <div class="cctv-title">Entr√©e principale <span class="cctv-status">En ligne</span></div>
          <img class="cctv-thumb" src="https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=800&q=50" alt="Cam Entr√©e" loading="lazy">
          <video class="cctv-video" poster="https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=800&q=50" data-src="https://samplelib.com/lib/preview/mp4/sample-15s.mp4" autoplay loop muted playsinline></video>
        </div>
        <div class="cctv-card">
          <div class="cctv-title">Cour de promenade <span class="cctv-status">En ligne</span></div>
          <img class="cctv-thumb" src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=50" alt="Cam Cour" loading="lazy">
          <video class="cctv-video" poster="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=800&q=50" data-src="https://samplelib.com/lib/preview/mp4/sample-20s.mp4" autoplay loop muted playsinline></video>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Email -->
<div class="window email-window" id="email-window">
  <div class="title-bar">
    <span class="title-bar-icon">üìß</span>
    <span class="title-bar-text">Courrier √©lectronique - Brolingboke Mail</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="email-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content">
    <div class="email-content">
      <div class="email-sidebar">
        <div class="email-folder active" data-folder="inbox">
          üì• Bo√Æte de r√©ception <span style="font-weight:bold;color:#cc0000;">(3)</span>
        </div>
        <div class="email-folder" data-folder="sent">üì§ Messages envoy√©s</div>
        <div class="email-folder" data-folder="drafts">üìù Brouillons</div>
        <div class="email-folder" data-folder="trash">üóëÔ∏è Corbeille</div>
      </div>
      <div class="email-list" id="email-list"></div>
      <div class="email-preview" id="email-preview">
        <p style="text-align:center;color:#999;padding:60px 20px;">S√©lectionnez un message pour l'afficher</p>
      </div>
    </div>
  </div>
</div>

<!-- Fen√™tre Statistiques Population -->
<div class="window" id="population-window" style="display:none; width:800px; height:500px; z-index: 1020;">
  <div class="title-bar">
    <span class="title-bar-icon">üìà</span>
    <span class="title-bar-text">Statistiques Population - Brolingboke D.O.C.</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="population-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content" style="display:flex; flex-direction:column; gap:12px; padding:12px; overflow-y:auto;">
    <div style="display:flex; gap:12px; flex-wrap:wrap;">
      <div style="flex:1; min-width:140px; background:#e8f4f8; border-radius:4px; padding:10px; text-align:center; font-weight:bold;">
        <div style="font-size:24px; color:#1a5cb8;">868</div>
        <div style="font-size:11px; color:#555;">Population totale</div>
      </div>
      <div style="flex:1; min-width:140px; background:#f0e8f8; border-radius:4px; padding:10px; text-align:center; font-weight:bold;">
        <div style="font-size:24px; color:#8e44ad;">92%</div>
        <div style="font-size:11px; color:#555;">Taux d'occupation</div>
      </div>
      <div style="flex:1; min-width:140px; background:#e8f8e8; border-radius:4px; padding:10px; text-align:center; font-weight:bold;">
        <div style="font-size:24px; color:#27ae60;">142</div>
        <div style="font-size:11px; color:#555;">Arriv√©es (mois)</div>
      </div>
      <div style="flex:1; min-width:140px; background:#f8e8e8; border-radius:4px; padding:10px; text-align:center; font-weight:bold;">
        <div style="font-size:24px; color:#c0392b;">118</div>
        <div style="font-size:11px; color:#555;">D√©parts (mois)</div>
      </div>
    </div>
    <div style="display:flex; gap:12px; flex:1; min-height:0;">
      <div style="flex:1; background:var(--xp-window-bg); border:1px solid #ccc; border-radius:4px; padding:10px;">
        <div style="font-weight:bold; margin-bottom:8px; font-size:12px;">Population par bloc</div>
        <canvas id="population-by-block" style="max-height:220px;"></canvas>
      </div>
      <div style="width:250px; background:var(--xp-window-bg); border:1px solid #ccc; border-radius:4px; padding:10px;">
        <div style="font-weight:bold; margin-bottom:8px; font-size:12px;">Classification</div>
        <canvas id="population-by-type" style="max-height:220px;"></canvas>
      </div>
    </div>
    <div style="background:var(--xp-window-bg); border:1px solid #ccc; border-radius:4px; padding:10px;">
      <div style="font-weight:bold; margin-bottom:8px; font-size:12px;">√âvolution population (12 mois)</div>
      <canvas id="population-trend" style="max-height:150px;"></canvas>
    </div>
  </div>
</div>

<!-- Calendrier -->
<div class="window calendar-window" id="calendar-window">
  <div class="title-bar">
    <span class="title-bar-icon">üìÖ</span>
    <span class="title-bar-text">Calendrier</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="calendar-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content">
    <div class="calendar-content">
      <div class="calendar-header">
        <button class="xp-button" id="prev-month-btn">‚óÄ</button>
        <div class="calendar-month" id="calendar-month">Janvier 2026</div>
        <button class="xp-button" id="next-month-btn">‚ñ∂</button>
      </div>
      <div class="calendar-grid" id="calendar-grid"></div>
    </div>
  </div>
</div>

<!-- Param√®tres -->
<div class="window settings-window" id="settings-window">
  <div class="title-bar">
    <span class="title-bar-icon">‚öôÔ∏è</span>
    <span class="title-bar-text">Param√®tres syst√®me</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="settings-close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content">
    <div class="settings-content">
      <div class="settings-section">
        <div class="settings-title">üé® Apparence</div>
        <div class="settings-option">
          <div class="settings-option-label">Th√®me du bureau</div>
          <div class="settings-option-control">
            <select class="xp-select" id="theme-select">
              <option value="blue">Bleu GrandLine XP</option>
              <option value="olive">Vert olive</option>
              <option value="silver">Argent</option>
            </select>
          </div>
        </div>
        <div class="settings-option">
          <div class="settings-option-label">Afficher les ic√¥nes du bureau</div>
          <div class="settings-option-control">
            <input type="checkbox" class="xp-checkbox" checked id="show-icons-checkbox">
          </div>
        </div>
      </div>
      <div class="settings-section">
        <div class="settings-title">üîä Son</div>
        <div class="settings-option">
          <div class="settings-option-label">Volume principal</div>
          <div class="settings-option-control">
            <input type="range" min="0" max="100" value="50" id="main-volume-slider">
            <span id="volume-display">50%</span>
          </div>
        </div>
        <div class="settings-option">
          <div class="settings-option-label">Sons syst√®me</div>
          <div class="settings-option-control">
            <input type="checkbox" class="xp-checkbox" checked id="system-sounds-checkbox">
          </div>
        </div>
      </div>
      <div class="settings-section">
        <div class="settings-title">üîî Notifications</div>
        <div class="settings-option">
          <div class="settings-option-label">Afficher les notifications</div>
          <div class="settings-option-control">
            <input type="checkbox" class="xp-checkbox" checked id="notifications-checkbox">
          </div>
        </div>
      </div>
      <div class="settings-section">
        <div class="settings-title">‚ÑπÔ∏è Informations syst√®me</div>
        <div style="font-size:11px;line-height:1.6;color:#333;">
          <strong>Syst√®me d'exploitation:</strong> GrandLine XP Professional<br>
          <strong>Version:</strong> 5.1.2600 Service Pack 3<br>
          <strong>Ordinateur:</strong> BROLINGBOKE-PC<br>
          <strong>Processeur:</strong> Intel Pentium 4 3.20GHz<br>
          <strong>M√©moire RAM:</strong> 512 MB<br>
          <strong>Licence:</strong> Brolingboke D.O.C. Enterprise
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Fen√™tre principale D.O.C. -->
<div class="window" id="main-window">
  <div class="title-bar">
    <span class="title-bar-icon">üèõÔ∏è</span>
    <span class="title-bar-text">Brolingboke D.O.C. - Base de Donn√©es des D√©tenus</span>
    <div class="title-bar-buttons">
      <button class="title-bar-button btn-minimize">_</button>
      <button class="title-bar-button btn-maximize">‚ñ°</button>
      <button class="title-bar-button btn-close" id="close-btn">‚úï</button>
    </div>
  </div>
  <div class="window-content">
    <div id="login-view" class="login-view" style="display:flex">
      <div class="login-box">
        <div class="login-header">
          <div class="login-header-icon">üèõÔ∏è</div>
          <div class="login-header-text">Connexion S√©curis√©e</div>
        </div>
        <div class="login-body">
          <div id="login-error" class="login-error"></div>
          <div class="login-field">
            <label class="xp-label" for="email">Identifiant :</label>
            <input type="text" id="email" class="xp-input" placeholder="Entrez votre identifiant">
          </div>
          <div class="login-field">
            <label class="xp-label" for="password">Mot de passe :</label>
            <input type="password" id="password" class="xp-input" placeholder="Entrez votre mot de passe">
          </div>
          <div class="login-actions">
            <button type="button" id="login-btn" class="xp-button xp-button-primary">Se connecter</button>
          </div>
        </div>
      </div>
    </div>
    <div id="main-view" style="display:none">
      <div class="main-header">
        <h1>Registre des D√©tenus <span id="user-role-badge" class="user-badge"></span></h1>
        <button id="add-inmate-btn" class="xp-button" style="display:none">‚ûï Ajouter un d√©tenu</button>
      </div>
      <div class="main-toolbar">
        <div class="search-container">
          <input type="search" id="search-input" class="xp-input" placeholder="Rechercher par nom, alias, crime, cellule...">
        </div>
      </div>
      <div class="main-content">
        <div id="inmates-list"></div>
        <div id="no-results" class="hidden">Aucun d√©tenu trouv√© correspondant √† votre recherche.</div>
      </div>
    </div>
    <div id="detail-view" style="display:none">
      <div class="detail-header">
        <button id="back-to-list-btn" class="xp-button">‚óÄ Retour √† la liste</button>
      </div>
      <div class="detail-content">
        <div class="detail-card">
          <div class="detail-card-header">
            <div class="detail-avatar">üë§</div>
            <div class="detail-title">
              <h2 id="detail-name"></h2>
              <p id="detail-alias"></p>
            </div>
          </div>
          <div class="detail-grid">
            <div class="detail-grid-item"><div class="detail-grid-label">√Çge</div><div class="detail-grid-value" id="detail-age"></div></div>
            <div class="detail-grid-item"><div class="detail-grid-label">Bloc</div><div class="detail-grid-value" id="detail-block"></div></div>
            <div class="detail-grid-item"><div class="detail-grid-label">Cellule</div><div class="detail-grid-value" id="detail-cell"></div></div>
            <div class="detail-grid-item"><div class="detail-grid-label">Dur√©e de peine</div><div class="detail-grid-value" id="detail-sentence"></div></div>
            <div class="detail-grid-item"><div class="detail-grid-label">Date d'incarc√©ration</div><div class="detail-grid-value" id="detail-start-date"></div></div>
            <div class="detail-grid-item"><div class="detail-grid-label">Date de lib√©ration</div><div class="detail-grid-value" id="detail-end-date"></div></div>
          </div>
          <div class="detail-sections">
            <div class="detail-section"><div class="detail-section-title">üìã D√©tails du Crime</div><div class="detail-section-content" id="detail-crime"></div></div>
            <div class="detail-section"><div class="detail-section-title">üìñ Historique</div><div class="detail-section-content" id="detail-backstory"></div></div>
            <div class="detail-section"><div class="detail-section-title">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Famille & Relations</div><div class="detail-section-content" id="detail-family"></div></div>
            <div id="detail-admin-notes-section" class="detail-section admin-notes-section hidden"><div class="detail-section-title">‚ö†Ô∏è Notes Internes (Admin)</div><div class="detail-section-content" id="detail-admin-notes"></div></div>
          </div>
          <div id="detail-admin-buttons" class="detail-actions hidden">
            <button id="edit-inmate-btn" class="xp-button">‚úèÔ∏è Modifier</button>
            <button id="delete-inmate-btn" class="xp-button xp-button-danger">üóëÔ∏è Supprimer</button>
          </div>
        </div>
      </div>
    </div>
    <div id="form-view" style="display:none">
      <div class="detail-header"><button id="back-from-form-btn" class="xp-button">‚óÄ Retour</button></div>
      <div class="form-content">
        <form id="inmate-form" class="form-card">
          <input type="hidden" id="inmate-id">
          <div class="form-section">
            <div class="form-section-title">üë§ Informations d'Identit√©</div>
            <div class="form-grid">
              <div class="form-field"><label class="xp-label required" for="name">Nom Complet</label><input type="text" id="name" class="xp-input" required></div>
              <div class="form-field"><label class="xp-label" for="alias">Alias / Surnom</label><input type="text" id="alias" class="xp-input"></div>
              <div class="form-field"><label class="xp-label required" for="age">√Çge</label><input type="number" id="age" class="xp-input" required min="18" max="120"></div>
            </div>
          </div>
          <div class="form-section">
            <div class="form-section-title">üè¢ Informations d'Incarc√©ration</div>
            <div class="form-grid">
              <div class="form-field"><label class="xp-label required" for="block">Bloc</label><input type="text" id="block" class="xp-input" required maxlength="10"></div>
              <div class="form-field"><label class="xp-label required" for="cell">Cellule</label><input type="text" id="cell" class="xp-input" required maxlength="10"></div>
              <div class="form-field"><label class="xp-label" for="sentenceDuration">Dur√©e de la peine</label><input type="text" id="sentenceDuration" class="xp-input" placeholder="Ex: 25 ans"></div>
              <div class="form-field form-checkbox"><input type="checkbox" id="isLifeSentence" class="xp-checkbox"><label class="xp-label" for="isLifeSentence">Condamnation √† perp√©tuit√©</label></div>
              <div class="form-field"><label class="xp-label" for="startDate">Date d'incarc√©ration</label><input type="date" id="startDate" class="xp-input"></div>
              <div class="form-field"><label class="xp-label" for="endDate">Date de lib√©ration pr√©vue</label><input type="date" id="endDate" class="xp-input"></div>
            </div>
          </div>
          <div class="form-section">
            <div class="form-section-title">üìã Dossier</div>
            <div class="form-grid">
              <div class="form-field full-width"><label class="xp-label" for="crimeDetails">D√©tails du crime</label><textarea id="crimeDetails" class="xp-input form-textarea"></textarea></div>
              <div class="form-field full-width"><label class="xp-label" for="backstory">Historique / Parcours</label><textarea id="backstory" class="xp-input form-textarea"></textarea></div>
              <div class="form-field full-width"><label class="xp-label" for="family">Famille & Relations</label><textarea id="family" class="xp-input form-textarea"></textarea></div>
            </div>
          </div>
          <div id="form-admin-notes-section" class="form-section form-admin-section hidden">
            <div class="form-section-title">‚ö†Ô∏è Notes Internes (Admin uniquement)</div>
            <div class="form-field"><textarea id="adminNotes" class="xp-input form-textarea" placeholder="Notes confidentielles visibles uniquement par les administrateurs..."></textarea></div>
          </div>
          <div id="form-error" class="form-message form-error hidden"></div>
          <div id="form-success" class="form-message form-success hidden"></div>
          <div class="form-actions">
            <button type="button" id="cancel-form-btn" class="xp-button">Annuler</button>
            <button type="submit" class="xp-button xp-button-primary">üíæ Enregistrer</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div id="delete-modal">
  <div class="modal-window">
    <div class="modal-title-bar"><span>Confirmation</span></div>
    <div class="modal-content">
      <div class="modal-icon">‚ö†Ô∏è</div>
      <div class="modal-text">
        <h3>Confirmer la suppression</h3>
        <p>√ätes-vous s√ªr de vouloir supprimer d√©finitivement ce dossier de d√©tenu ? Cette action est irr√©versible.</p>
      </div>
    </div>
    <div class="modal-actions">
      <button id="cancel-delete-btn" class="xp-button">Non</button>
      <button id="confirm-delete-btn" class="xp-button xp-button-danger">Oui, supprimer</button>
    </div>
  </div>
</div>

<script>
// Variables globales
let u=null,r='none',v='login',ci=null,dt=null,kp=false;
let currentPath='documents',openWindows=new Set(),pathHistory=[],volumeLevel=50;
let currentMonth=0,currentYear=2026,gameTime=0,gameInterval=null,minesweeperStarted=false;
let currentEmail=null;

// Syst√®me de fichiers virtuel
const fileSystem={
  desktop:[
    {name:'Poste de travail',type:'computer',icon:'üíª'},
    {name:'Brolingboke D.O.C.',type:'app',icon:'üèõÔ∏è'},
    {name:'Mes documents',type:'folder',icon:'üìÅ',path:'documents'},
    {name:'Courrier √©lectronique',type:'app',icon:'üìß',app:'email'},
    {name:'Corbeille',type:'recycle',icon:'üóëÔ∏è'}
  ],
  documents:[
    {name:'Personnel',type:'folder',icon:'üìÅ',path:'documents/personnel'},
    {name:'Rapports',type:'folder',icon:'üìÅ',path:'documents/rapports'},
    {name:'Readme.txt',type:'file',icon:'üìÑ',content:'Bienvenue dans le syst√®me Brolingboke D.O.C.\n\nCe syst√®me contient des informations sensibles.\nAcc√®s r√©serv√© au personnel autoris√© uniquement.\n\n¬© 2025 Brolingboke Correctional Systems'}
  ],
  'documents/personnel':[
    {name:'Notes personnelles',type:'folder',icon:'üìÅ',path:'documents/personnel/notes'},
    {name:'CV.txt',type:'file',icon:'üìÑ',content:'Curriculum Vitae\n\nAgent de correction p√©nitentiaire\nBrolingboke Department of Corrections\n\nExp√©rience: 8 ans\nFormation: Acad√©mie de police de Los Santos\n\nComp√©tences:\n- Gestion de crise\n- Communication interpersonnelle\n- Connaissance du syst√®me judiciaire'}
  ],
  'documents/personnel/notes':[
    {name:'Si jamais j\'oublie.txt',type:'file',icon:'üìÑ',content:'Si jamais j\'oublie...\n\n================================\n   IDENTIFIANTS D\'ACC√àS\n================================\n\nIdentifiant : user\nMDP : user\n\n================================\n\nNe pas perdre ce fichier !'},
    {name:'Liste courses.txt',type:'file',icon:'üìÑ',content:'Liste de courses:\n\n- Lait\n- Pain\n- ≈íufs\n- Caf√©\n- Fruits\n- L√©gumes\n- Poulet\n- Riz'},
    {name:'Id√©es weekend.txt',type:'file',icon:'üìÑ',content:'Id√©es pour le weekend:\n\n- Cin√©ma avec les amis\n- Randonn√©e au Chiliad\n- Barbecue en famille\n- Finir la s√©rie en cours\n- Repos bien m√©rit√©'}
  ],
  'documents/rapports':[
    {name:'Rapport_Janvier_2025.txt',type:'file',icon:'üìÑ',content:'RAPPORT MENSUEL - JANVIER 2025\n\nBrolingboke D.O.C.\n\nPopulation carc√©rale: 847 d√©tenus\nIncidents: 12\nDisciplinaires: 23\nVisites: 156\n\nCommentaires:\nMois calme dans l\'ensemble.\nQuelques tensions au bloc C.\nFormation du nouveau personnel r√©ussie.'},
    {name:'Rapport_F√©vrier_2025.txt',type:'file',icon:'üìÑ',content:'RAPPORT MENSUEL - F√âVRIER 2025\n\nBrolingboke D.O.C.\n\nPopulation carc√©rale: 851 d√©tenus\nIncidents: 8\nDisciplinaires: 19\nVisites: 142\n\nCommentaires:\nAm√©lioration g√©n√©rale du comportement.\nNouveau programme de r√©insertion lanc√©.'}
  ],
  computer:[
    {name:'Disque local (C:)',type:'drive',icon:'üíæ'},
    {name:'Lecteur CD (D:)',type:'cd',icon:'üíø'},
    {name:'Mes documents',type:'folder',icon:'üìÅ',path:'documents'}
  ]
};

// Emails
const emails={
  inbox:[
    {id:1,from:'Direction Brolingboke',subject:'Nouvelle proc√©dure de s√©curit√©',date:'30/01/2026',preview:'√Ä partir du 1er f√©vrier, tous les agents devront...',unread:true,body:'√Ä partir du 1er f√©vrier, tous les agents devront utiliser leur badge RFID pour acc√©der aux zones s√©curis√©es.\n\nLa direction rappelle que les proc√©dures de s√©curit√© sont essentielles pour garantir la s√ªret√© de tous.\n\nMerci de votre coop√©ration.\n\nDirection Brolingboke D.O.C.'},
    {id:2,from:'RH - Service du personnel',subject:'Rappel: Formation obligatoire',date:'29/01/2026',preview:'La formation sur les nouvelles r√©glementations...',unread:true,body:'Bonjour,\n\nNous vous rappelons que la formation sur les nouvelles r√©glementations p√©nitentiaires aura lieu le 5 f√©vrier √† 14h00 en salle de conf√©rence.\n\nPr√©sence obligatoire.\n\nCordialement,\nService RH'},
    {id:3,from:'Comptoir du personnel',subject:'Vos fiches de paie sont disponibles',date:'28/01/2026',preview:'Vos fiches de paie pour le mois de janvier...',unread:false,body:'Bonjour,\n\nVos fiches de paie pour le mois de janvier sont maintenant disponibles sur le portail interne.\n\nConnectez-vous avec vos identifiants habituels.\n\nBonne journ√©e,\nComptabilit√©'}
  ],
  sent:[],
  drafts:[],
  trash:[]
};

// Base de donn√©es des d√©tenus
let inmates = [
  {id:"1",name:"Kelvin Moreau",alias:"MiisterKel",age:32,block:"B",cell:"204",sentenceDuration:"7 ans",startDate:"2024-02-18",endDate:"2031-02-17",isLifeSentence:false,crimeDetails:"Blanchiment d'argent, escroqueries num√©riques √† grande √©chelle.",backstory:"Influenceur financier clandestin ayant mont√© un r√©seau de faux investissements.",family:"Parents refusent tout contact.",adminNotes:"Manipulateur. Surveille les interactions."},
  {id:"2",name:"Odon Muray",alias:"Oddmour",age:41,block:"C",cell:"119",sentenceDuration:"15 ans",startDate:"2022-09-03",endDate:"2037-09-02",isLifeSentence:false,crimeDetails:"Homicide involontaire, trafic d'armes.",backstory:"Ancien mercenaire reconverti en interm√©diaire criminel.",family:"Une s≈ìur, visites rares.",adminNotes:"Calme mais impr√©visible."},
  {id:"3",name:"Thomas Ricci",alias:"Toma",age:27,block:"A",cell:"056",sentenceDuration:"5 ans",startDate:"2023-06-11",endDate:"2028-06-10",isLifeSentence:false,crimeDetails:"Vols √† main arm√©e, association de malfaiteurs.",backstory:"Petit ex√©cutant de gang urbain.",family:"M√®re pr√©sente aux parloirs.",adminNotes:"Influen√ßable."},
  {id:"4",name:"Donatello Cruz",alias:"DON",age:50,block:"D",cell:"089",sentenceDuration:"20 ans",startDate:"2020-01-22",endDate:"2040-01-21",isLifeSentence:false,crimeDetails:"Crime organis√©, corruption, extorsion.",backstory:"Ancien parrain local gardant une forte autorit√©.",family:"Visites fr√©quentes non d√©clar√©es.",adminNotes:"Leader naturel. Risque d'organisation interne."},
  {id:"5",name:"Lucas Ferra",alias:"Zipper",age:24,block:"B",cell:"231",sentenceDuration:"4 ans",startDate:"2024-05-09",endDate:"2028-05-08",isLifeSentence:false,crimeDetails:"Cybercriminalit√©, sabotage informatique.",backstory:"Hacker autodidacte recrut√© par des r√©seaux criminels.",family:"Aucune information.",adminNotes:"Isolement volontaire."},
  {id:"6",name:"Charles Noctis",alias:"Charon",age:38,block:"C",cell:"142",sentenceDuration:"Perp√©tuit√©",startDate:"2018-11-30",endDate:"",isLifeSentence:true,crimeDetails:"Meurtres multiples avec pr√©m√©ditation.",backstory:"Tueur m√©thodique surnomm√© le passeur.",family:"Aucun contact.",adminNotes:"Extr√™mement dangereux."},
  {id:"7",name:"Enzo Navarro",alias:"Eny",age:29,block:"A",cell:"063",sentenceDuration:"6 ans",startDate:"2021-10-14",endDate:"2027-10-13",isLifeSentence:false,crimeDetails:"Trafic de stup√©fiants, faux documents.",backstory:"Logisticien discret pour r√©seaux locaux.",family:"Compagne occasionnelle.",adminNotes:"Bonne conduite."},
  {id:"8",name:"Samuel Ortega",alias:"Storm",age:35,block:"D",cell:"102",sentenceDuration:"12 ans",startDate:"2019-04-07",endDate:"2031-04-06",isLifeSentence:false,crimeDetails:"Violences aggrav√©es, √©meutes arm√©es.",backstory:"Ancien meneur radical.",family:"Famille absente.",adminNotes:"Col√©rique."},
  {id:"9",name:"Stanis Lass",alias:"Stayss",age:22,block:"B",cell:"198",sentenceDuration:"3 ans",startDate:"2024-01-03",endDate:"2027-01-02",isLifeSentence:false,crimeDetails:"Cambriolages en s√©rie.",backstory:"Jeune d√©linquant instable.",family:"Aucun soutien familial.",adminNotes:"Suivi psychologique conseill√©."},
  {id:"10",name:"Ryan Voxler",alias:"Ryvox",age:34,block:"C",cell:"150",sentenceDuration:"9 ans",startDate:"2022-12-01",endDate:"2031-11-30",isLifeSentence:false,crimeDetails:"Courses ill√©gales, homicides involontaires.",backstory:"Pilote clandestin underground.",family:"Fr√®re cadet en contact.",adminNotes:"Risque d√©pressif."}
];

// Fonctions utilitaires
function upd(){const n=new Date();document.getElementById('clock').textContent=n.getHours().toString().padStart(2,'0')+':'+n.getMinutes().toString().padStart(2,'0');}

function showNotification(icon,title,text){
  playSound('notification');
  const notif=document.createElement('div');
  notif.className='notification';
  notif.innerHTML=`
    <div class="notification-icon">${icon}</div>
    <div class="notification-content">
      <div class="notification-title">${title}</div>
      <div class="notification-text">${text}</div>
    </div>
    <div class="notification-close">‚úï</div>
  `;
  document.getElementById('notification-area').appendChild(notif);
  notif.querySelector('.notification-close').addEventListener('click',()=>notif.remove());
  notif.addEventListener('click',()=>notif.remove());
  setTimeout(()=>notif.remove(),5000);
}

// S√©quence BIOS
function bios(){
  playSound('error'); // Son de boot
  const msgs=[{text:'BROLINGBOKE CORRECTIONAL SYSTEMS',class:'highlight'},{text:'Phoenix-Award BIOS v4.2.1, An Energy Star Ally',class:''},{text:'Copyright (C) 2025, Brolingboke Technologies Ltd.',class:''},{text:'',class:''},{text:'Main Processor : Intel(R) Pentium(R) 4 CPU 3.20GHz',class:''},{text:'Memory Testing :  524288K OK',class:'success'},{text:'',class:''},{text:'Detecting IDE Primary Master   ... SECURITY_DB_v1.0',class:'value'},{text:'Detecting IDE Primary Slave    ... INMATE_RECORDS',class:'value'},{text:'Detecting IDE Secondary Master ... DVD-ROM',class:'value'},{text:'Detecting IDE Secondary Slave  ... None',class:''},{text:'',class:''},{text:'Initializing security protocols...',class:''},{text:'Loading firewall configurations...',class:''},{text:'Mounting encrypted partitions... OK',class:'success'},{text:'Verifying biometric sensors... OK',class:'success'},{text:'',class:''},{text:'System initialization complete.',class:'highlight'}];
  let i=0;const t=document.getElementById('bios-text');
  const iv=setInterval(()=>{if(i<msgs.length){const l=document.createElement('div');l.textContent=msgs[i].text;if(msgs[i].class)l.className=msgs[i].class;t.appendChild(l);i++;}else clearInterval(iv);},80);
  document.addEventListener('keydown',function kh(){if(!kp){kp=true;clearInterval(iv);document.removeEventListener('keydown',kh);setTimeout(()=>{document.getElementById('bios').style.display='none';document.getElementById('boot').style.display='flex';setTimeout(()=>{document.getElementById('boot').style.display='none';document.getElementById('startup').style.display='flex';startup();},2000);},300);}});
}

// S√©quence de d√©marrage
function startup(){
  playSound('startup');
  const msgs=['Chargement des param√®tres personnels...','Application des param√®tres de s√©curit√©...','Connexion au serveur central...','Initialisation de la base de donn√©es...','Pr√©paration du bureau...'];
  let p=0,mi=0;const pb=document.getElementById('startup-progress'),txt=document.getElementById('startup-text');
  const iv=setInterval(()=>{p+=Math.random()*4+2;pb.style.width=Math.min(p,100)+'%';const nm=Math.floor((p/100)*msgs.length);if(nm!==mi&&nm<msgs.length){mi=nm;txt.textContent=msgs[mi];}if(p>=100){clearInterval(iv);setTimeout(()=>{document.getElementById('startup').style.display='none';showLoginScreen();},800);}},80);
}

// √âcran de connexion
function showLoginScreen(){
  document.getElementById('login-screen').style.display='flex';
  document.getElementById('profile-warden').addEventListener('click',loginProfile);
}

function loginProfile(){
  playSound('click');
  document.getElementById('login-screen').style.display='none';
  document.getElementById('desktop').style.display='block';
  document.getElementById('taskbar').style.display='flex';
  playSound('logon');
  upd();
  setInterval(upd,1000);
  setTimeout(()=>{playSound('notification');showNotification('üëã','Bienvenue','Syst√®me GrandLine XP charg√© avec succ√®s');},1000);
}

// Gestion des sons
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const soundCache = {};

function playSound(type){
  try {
    let freq=[], dur=0.2;
    switch(type){
      case 'startup': freq=[523,659,784,523,659,784]; dur=0.08; break; // Jingle d√©marrage
      case 'click': freq=[880]; dur=0.05; break; // Clic
      case 'logon': freq=[392,493,587]; dur=0.15; break; // Logon success
      case 'error': freq=[196]; dur=0.3; break; // Erreur
      case 'notification': freq=[880,1100,900]; dur=0.08; break; // Notification wizz
      default: return;
    }
    freq.forEach((f,i)=>setTimeout(()=>{
      const now=audioContext.currentTime;
      const osc=audioContext.createOscillator();
      const env=audioContext.createGain();
      osc.connect(env);
      env.connect(audioContext.destination);
      osc.frequency.value=f;
      env.gain.setValueAtTime(0.15, now);
      env.gain.exponentialRampToValueAtTime(0.01, now+dur);
      osc.start(now);
      osc.stop(now+dur);
    },i*dur*1000));
  }catch(e){}
}

// Explorateur de fichiers
function openExplorer(path='documents'){
  currentPath=path;
  pathHistory.push(path);
  const win=document.getElementById('explorer-window');
  const main=document.getElementById('explorer-main');
  const addressBar=document.getElementById('address-bar');
  const title=document.getElementById('explorer-title');
  const fileCount=document.getElementById('file-count');
  const backBtn=document.getElementById('back-btn');
  
  win.style.display='block';
  addTaskbarItem('explorer','üìÅ','Explorateur');
  
  const pathParts=path.split('/');
  const currentFolder=pathParts[pathParts.length-1];
  title.textContent=currentFolder.charAt(0).toUpperCase()+currentFolder.slice(1);
  addressBar.value='C:\\'+path.replace(/\//g,'\\');
  
  backBtn.disabled=pathHistory.length<=1;
  
  const files=fileSystem[path]||[];
  main.innerHTML='<div class="file-grid"></div>';
  const grid=main.querySelector('.file-grid');
  
  files.forEach(file=>{
    const item=document.createElement('div');
    item.className='file-item';
    item.innerHTML=`
      <div class="file-icon">${file.icon}</div>
      <div class="file-name">${file.name}</div>
    `;
    
    item.addEventListener('dblclick',()=>{
      if(file.type==='folder'){
        openExplorer(file.path);
      }else if(file.type==='file'){
        openNotepad(file.name,file.content);
      }else if(file.type==='app'&&file.app==='email'){
        openEmail();
      }else if(file.type==='app'){
        openDocApp();
      }
    });
    
    grid.appendChild(item);
  });
  
  fileCount.textContent=`${files.length} objet${files.length>1?'s':''}`;
  
  document.querySelectorAll('.sidebar-item').forEach(item=>{
    item.classList.remove('active');
    if(item.dataset.path===path.split('/')[0]){
      item.classList.add('active');
    }
  });
}

// Bloc-notes
function openNotepad(filename,content){
  const win=document.getElementById('notepad-window');
  const title=document.getElementById('notepad-title');
  const textarea=document.getElementById('notepad-content');
  
  win.style.display='block';
  title.textContent=`${filename} - Bloc-notes`;
  textarea.value=content;
  addTaskbarItem('notepad','üìù',filename);
}

// Application D.O.C.
function openDocApp(){
  document.getElementById('main-window').style.display='block';
  addTaskbarItem('doc','üèõÔ∏è','Brolingboke D.O.C.');
  v='login';
  ren();
}

// Email
function openEmail(){
  document.getElementById('email-window').style.display='block';
  addTaskbarItem('email','üìß','Courrier √©lectronique');
  loadEmails('inbox');
}

function loadEmails(folder){
  const list=document.getElementById('email-list');
  list.innerHTML='';
  
  document.querySelectorAll('.email-folder').forEach(f=>{
    f.classList.remove('active');
    if(f.dataset.folder===folder)f.classList.add('active');
  });
  
  const msgs=emails[folder]||[];
  msgs.forEach(email=>{
    const item=document.createElement('div');
    item.className='email-item'+(email.unread?' unread':'');
    item.innerHTML=`
      <div class="email-item-from">${email.from}</div>
      <div class="email-item-subject">${email.subject}</div>
      <div class="email-item-preview">${email.preview}</div>
    `;
    item.addEventListener('click',()=>showEmail(email));
    list.appendChild(item);
  });
}

function showEmail(email){
  const preview=document.getElementById('email-preview');
  preview.innerHTML=`
    <div class="email-preview-header">
      <div class="email-preview-from">De: ${email.from}</div>
      <div class="email-preview-subject">${email.subject}</div>
      <div class="email-preview-date">${email.date}</div>
    </div>
    <div class="email-preview-body">${email.body}</div>
  `;
  email.unread=false;
  loadEmails('inbox');
}

// Calendrier
function openCalendar(){
  document.getElementById('calendar-window').style.display='block';
  addTaskbarItem('calendar','üìÖ','Calendrier');
  renderCalendar();
}

function renderCalendar(){
  const grid=document.getElementById('calendar-grid');
  const monthNames=['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'];
  const dayNames=['Lun','Mar','Mer','Jeu','Ven','Sam','Dim'];
  
  document.getElementById('calendar-month').textContent=`${monthNames[currentMonth]} ${currentYear}`;
  
  grid.innerHTML='';
  dayNames.forEach(day=>{
    const header=document.createElement('div');
    header.className='calendar-day-header';
    header.textContent=day;
    grid.appendChild(header);
  });
  
  const firstDay=new Date(currentYear,currentMonth,1).getDay();
  const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
  const today=new Date();
  
  const startDay=firstDay===0?6:firstDay-1;
  
  for(let i=0;i<startDay;i++){
    const blank=document.createElement('div');
    blank.className='calendar-day other-month';
    grid.appendChild(blank);
  }
  
  for(let day=1;day<=daysInMonth;day++){
    const cell=document.createElement('div');
    cell.className='calendar-day';
    cell.textContent=day;
    
    if(day===today.getDate()&&currentMonth===today.getMonth()&&currentYear===today.getFullYear()){
      cell.classList.add('today');
    }
    
    grid.appendChild(cell);
  }
}

// D√©mineur
function openMinesweeper(){
  document.getElementById('minesweeper-window').style.display='block';
  addTaskbarItem('minesweeper','üí£','D√©mineur');
  initMinesweeper();
}

function initMinesweeper(){
  const grid=document.getElementById('minesweeper-grid');
  grid.innerHTML='';
  grid.style.gridTemplateColumns='repeat(8, 25px)';
  
  minesweeperStarted=false;
  gameTime=0;
  document.getElementById('game-time').textContent='0';
  
  if(gameInterval){
    clearInterval(gameInterval);
    gameInterval=null;
  }
  
  const mines=[];
  while(mines.length<10){
    const pos=Math.floor(Math.random()*64);
    if(!mines.includes(pos))mines.push(pos);
  }
  
  for(let i=0;i<64;i++){
    const cell=document.createElement('div');
    cell.className='mine-cell';
    cell.dataset.index=i;
    cell.dataset.mine=mines.includes(i)?'1':'0';
    
    cell.addEventListener('click',()=>{
      if(!minesweeperStarted){
        minesweeperStarted=true;
        gameInterval=setInterval(()=>{
          gameTime++;
          document.getElementById('game-time').textContent=gameTime;
        },1000);
      }
      
      if(cell.dataset.mine==='1'){
        cell.classList.add('revealed','mine');
        clearInterval(gameInterval);
        showNotification('üí•','Partie termin√©e','Vous avez touch√© une mine !');
        setTimeout(initMinesweeper,2000);
      }else{
        cell.classList.add('revealed');
        const neighbors=getNeighborMines(i,mines);
        if(neighbors>0){
          cell.textContent=neighbors;
          cell.style.color=['','blue','green','red','purple','maroon','turquoise','black','gray'][neighbors];
        }
      }
    });
    
    cell.addEventListener('contextmenu',e=>{
      e.preventDefault();
      cell.classList.toggle('flagged');
    });
    
    grid.appendChild(cell);
  }
}

function getNeighborMines(index,mines){
  const row=Math.floor(index/8);
  const col=index%8;
  let count=0;
  
  for(let r=row-1;r<=row+1;r++){
    for(let c=col-1;c<=col+1;c++){
      if(r>=0&&r<8&&c>=0&&c<8){
        const neighborIndex=r*8+c;
        if(mines.includes(neighborIndex))count++;
      }
    }
  }
  
  return count;
}

// Param√®tres
function openSettings(){
  document.getElementById('settings-window').style.display='block';
  addTaskbarItem('settings','‚öôÔ∏è','Param√®tres');
}

// Internet Explorer
function openInternet(){
  document.getElementById('internet-window').style.display='block';
  addTaskbarItem('internet','üåê','Internet Explorer');
  playSound('error');
}

// Lecteur media (Rick Astley)
// Remplacez MEDIA_MP3_URL par votre fichier/URL autoris√© de Never Gonna Give You Up
const MEDIA_MP3_URL='https://samplelib.com/lib/preview/mp3/sample-6s.mp3'; // Remplacer par votre MP3 autoris√© de Never Gonna Give You Up
function openMediaPlayer(){
  const win=document.getElementById('media-window');
  if(!win)return;
  win.style.display='block';
  addTaskbarItem('media','üéµ','Lecteur Media');
  const audio=document.getElementById('media-audio');
  const status=document.getElementById('media-status');
  const playBtn=document.getElementById('media-play-btn');
  if(audio){
    audio.src=MEDIA_MP3_URL+'?_ts='+(Date.now());
    const tryPlay=()=>{
      audio.play().then(()=>{if(status)status.textContent='Lecture...';}).catch(()=>{if(status)status.textContent='Lecture bloqu√©e, cliquez ‚ñ∂';});
    };
    if(playBtn) playBtn.onclick=()=>{tryPlay(); playSound('click');};
    tryPlay();
  }
}

// CCTV Surveillance
function refreshCCTV(){
  const statuses=['En ligne','D√©tection mouvement','Signal faible','Maintenance'];
  document.querySelectorAll('#cctv-grid .cctv-card').forEach(card=>{
    const stEl=card.querySelector('.cctv-status');
    if(!stEl)return;
    const pick=statuses[Math.floor(Math.random()*statuses.length)];
    stEl.textContent=pick;
    stEl.classList.toggle('cctv-alert', pick==='D√©tection mouvement' || pick==='Signal faible');
  });
}

function openCCTV(){
  const win=document.getElementById('cctv-window');
  if(!win)return;
  win.style.display='block';
  addTaskbarItem('cctv','üìπ','CCTV Surveillance');
  // Charge les flux vid√©o au moment de l'ouverture pour permettre de remplacer par vos flux GTA RP
  document.querySelectorAll('#cctv-grid .cctv-video').forEach(v=>{
    const src=v.getAttribute('data-src');
    if(src) v.src=src;
    const thumb=v.previousElementSibling && v.previousElementSibling.classList.contains('cctv-thumb') ? v.previousElementSibling : null;
    if(thumb){
      v.addEventListener('error',()=>{v.style.display='none'; thumb.style.opacity=1;});
      v.addEventListener('playing',()=>{v.style.display='block'; thumb.style.opacity=0.15;});
      v.addEventListener('loadeddata',()=>{thumb.style.opacity=0.15;});
    }
  });
  refreshCCTV();
}

// Calculatrice
let calcValue = '0';
function openCalculator(){
  document.getElementById('calculator-window').style.display='block';
  addTaskbarItem('calculator','üî¢','Calculatrice');
  calcValue = '0';
  document.getElementById('calc-display').value = '0';
}

function calcInput(val){
  if(calcValue === '0' && val !== '.'){
    calcValue = val;
  } else {
    calcValue += val;
  }
  document.getElementById('calc-display').value = calcValue;
}

function calcClear(){
  calcValue = '0';
  document.getElementById('calc-display').value = '0';
}

function calcBackspace(){
  if(calcValue.length > 1){
    calcValue = calcValue.slice(0, -1);
  } else {
    calcValue = '0';
  }
  document.getElementById('calc-display').value = calcValue;
}

function calcEquals(){
  try {
    const result = eval(calcValue.replace(/√ó/g, '*').replace(/√∑/g, '/'));
    calcValue = String(result);
    document.getElementById('calc-display').value = calcValue;
  } catch(e) {
    document.getElementById('calc-display').value = 'Erreur';
    calcValue = '0';
  }
}

// Panneau de configuration
function openControlPanel(){
  document.getElementById('control-panel-window').style.display='block';
  addTaskbarItem('control-panel','üéõÔ∏è','Panneau de configuration');
}

function showCPMessage(category){
  showNotification('üéõÔ∏è', 'Panneau de configuration', `Module "${category}" - Acc√®s restreint sur ce poste.`);
}

// Aide et support
function openHelp(){
  document.getElementById('help-window').style.display='block';
  addTaskbarItem('help','‚ùì','Aide et support');
}

function showHelpTopic(topic){
  showNotification('üìö', 'Aide Windows', `Rubrique "${topic}" charg√©e. Consultez la documentation interne.`);
}

// Barre des t√¢ches
function addTaskbarItem(id,icon,text){
  if(openWindows.has(id))return;
  openWindows.add(id);
  
  const tp=document.getElementById('taskbar-programs');
  const it=document.createElement('div');
  it.id='taskbar-'+id;
  it.className='taskbar-item active';
  it.innerHTML=`<span class="taskbar-item-icon">${icon}</span><span class="taskbar-item-text">${text}</span>`;
  tp.appendChild(it);
}

function removeTaskbarItem(id){
  openWindows.delete(id);
  const ti=document.getElementById('taskbar-'+id);
  if(ti)ti.remove();
}

// Menu d√©marrer
document.getElementById('start-btn').addEventListener('click',()=>{
  const menu=document.getElementById('start-menu');
  menu.style.display=menu.style.display==='none'||!menu.style.display?'block':'none';
});

document.addEventListener('click',e=>{
  const menu=document.getElementById('start-menu');
  const startBtn=document.getElementById('start-btn');
  if(!menu.contains(e.target)&&!startBtn.contains(e.target)){
    menu.style.display='none';
  }
});

document.querySelectorAll('.start-menu-item').forEach(item=>{
  item.addEventListener('click',()=>{
    const app=item.dataset.app;
    document.getElementById('start-menu').style.display='none';
    
    if(app==='doc')openDocApp();
    else if(app==='email')openEmail();
    else if(app==='explorer')openExplorer('documents');
    else if(app==='calendar')openCalendar();
    else if(app==='minesweeper')openMinesweeper();
    else if(app==='settings')openSettings();
  });
});

document.querySelectorAll('.start-menu-shortcut').forEach(item=>{
  item.addEventListener('click',()=>{
    const path=item.dataset.path;
    document.getElementById('start-menu').style.display='none';
    openExplorer(path);
  });
});

// Menu contextuel du bureau
const ctxMenu=document.getElementById('context-menu');
const desktopArea=document.getElementById('desktop');
if(ctxMenu && desktopArea){
  desktopArea.addEventListener('contextmenu',e=>{
    e.preventDefault();
    ctxMenu.style.display='block';
    const rect={w:ctxMenu.offsetWidth||180,h:ctxMenu.offsetHeight||200};
    const x=Math.min(e.clientX, window.innerWidth-rect.w-4);
    const y=Math.min(e.clientY, window.innerHeight-rect.h-4);
    ctxMenu.style.left=x+'px';
    ctxMenu.style.top=y+'px';
  });
  document.addEventListener('click',e=>{
    if(ctxMenu.style.display==='block' && !ctxMenu.contains(e.target)) ctxMenu.style.display='none';
  });
  const ctxActions={
    'ctx-refresh':()=>location.reload(),
    'ctx-new-folder':()=>showNotification('üìÅ','Bureau','Nouveau dossier (simul√©)'),
    'ctx-new-file':()=>showNotification('üìÑ','Bureau','Nouveau fichier texte (simul√©)'),
    'ctx-paste':()=>showNotification('üìã','Presse-papiers','Rien √† coller ici'),
    'ctx-display':()=>showNotification('üñ•Ô∏è','Affichage','Param√®tres non disponibles en mode d√©mo'),
    'ctx-properties':()=>showNotification('‚öôÔ∏è','Propri√©t√©s','Poste Brolingboke XP - mode restreint')
  };
  Object.keys(ctxActions).forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.addEventListener('click',()=>{ctxMenu.style.display='none';ctxActions[id]();});
  });
}

// Boutons shutdown
document.getElementById('logoff-btn').addEventListener('click',()=>{
  location.reload();
});

document.getElementById('shutdown-btn').addEventListener('click',()=>{
  document.body.innerHTML='<div style="position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;font-family:Tahoma;">Il est maintenant possible d\'√©teindre l\'ordinateur en toute s√©curit√©.</div>';
});

// Volume
document.getElementById('volume-icon').addEventListener('click',()=>{
  const popup=document.getElementById('volume-popup');
  popup.style.display=popup.style.display==='none'||!popup.style.display?'flex':'none';
});

document.getElementById('volume-slider').addEventListener('input',e=>{
  volumeLevel=e.target.value;
  e.target.nextElementSibling.textContent=volumeLevel+'%';
});

document.getElementById('main-volume-slider').addEventListener('input',e=>{
  volumeLevel=e.target.value;
  document.getElementById('volume-display').textContent=volumeLevel+'%';
});

// Horloge cliquable
document.getElementById('clock').addEventListener('click',()=>openCalendar());

// Contenus des fichiers du bureau
const desktopFiles={
  'notes_reunion.txt': `R√âUNION DU 15/01/2026 - S√âCURIT√â P√âNITENTIAIRE
=============================================
 
Pr√©sents: Dir. Martinez, Adj. Dubois, Chef Moreau
 
Points abord√©s:
- R√©vision des protocoles d'√©vacuation
- Formation du nouveau personnel (session pr√©vue 22/01)
- Mise √† jour du syst√®me de badges
- Incident du bloc B r√©gl√©
 
√Ä FAIRE:
[ ] Commander nouveau mat√©riel de surveillance
[ ] Planifier inspection mensuelle
[ ] Valider les cong√©s de f√©vrier
 
Prochaine r√©union: 29/01/2026 - 14h00`,
 
  'planning_semaine.txt': `PLANNING SEMAINE 05 - 2026
===========================
 
LUNDI 27/01
  08:00 - Briefing √©quipe
  10:00 - Visite cellules bloc A
  14:00 - Formation s√©curit√© incendie
 
MARDI 28/01
  09:00 - R√©union administrative
  11:00 - Contr√¥le inventaire
  15:00 - Entretien nouveau d√©tenu #4521
 
MERCREDI 29/01
  08:30 - Inspection cuisine
  14:00 - R√©union direction (salle B)
 
JEUDI 30/01
  10:00 - Audit externe
  14:00 - Mise √† jour dossiers
 
VENDREDI 31/01
  09:00 - D√©briefing semaine
  12:00 - Fin de service`,
 
  'contacts_urgence.txt': `CONTACTS D'URGENCE - √âTABLISSEMENT BROLINGBOKE
==============================================
 
DIRECTION
  Dir. Martinez ........... Poste 101
  Adj. Dubois ............. Poste 102
  Secr√©tariat ............. Poste 100
 
S√âCURIT√â
  PC S√©curit√© ............. Poste 911
  Chef de ronde ........... Poste 150
  Armurerie ............... Poste 155
 
M√âDICAL
  Infirmerie .............. Poste 200
  Dr. Lambert ............. Poste 201
  Urgences ext. ........... 15 ou 112
 
MAINTENANCE
  Service technique ....... Poste 300
  √âlectricit√© ............. Poste 301
  Plomberie ............... Poste 302
 
EXTERNE
  Gendarmerie ............. 17
  SAMU .................... 15
  Pompiers ................ 18`,
 
  'memo_direction.txt': `M√âMO INTERNE - CONFIDENTIEL
============================
De: Direction g√©n√©rale
√Ä: Tous les agents
Date: 20/01/2026
 
Objet: Nouvelles proc√©dures de s√©curit√©
 
Suite aux r√©cents √©v√©nements, nous rappelons √†
l'ensemble du personnel les points suivants:
 
1. Port du badge obligatoire en toutes circonstances
2. V√©rification syst√©matique des acc√®s
3. Signalement imm√©diat de tout comportement suspect
4. Interdiction des t√©l√©phones personnels en zone d√©tention
 
Le non-respect de ces consignes pourra entra√Æner
des sanctions disciplinaires.
 
La Direction`,
 
  'reglement_interne.pdf': `[Document PDF - R√®glement int√©rieur]
 
Ce fichier n√©cessite Adobe Reader pour √™tre ouvert.
 
R√©sum√© du contenu:
- Chapitre 1: Dispositions g√©n√©rales
- Chapitre 2: Droits et devoirs du personnel
- Chapitre 3: Proc√©dures de s√©curit√©
- Chapitre 4: Gestion des d√©tenus
- Chapitre 5: Sanctions disciplinaires
 
Document mis √† jour le 01/01/2026
Version 3.2`,
 
  'rapport_mensuel': `RAPPORT MENSUEL - D√âCEMBRE 2025
================================
 
STATISTIQUES G√âN√âRALES
  Population carc√©rale: 847 d√©tenus
  Capacit√©: 900 places
  Taux d'occupation: 94.1%
 
INCIDENTS
  Altercations mineures: 12
  Tentatives d'√©vasion: 0
  Infractions disciplinaires: 34
 
PERSONNEL
  Effectif total: 156 agents
  Arr√™ts maladie: 8
  Formations suivies: 23
 
OBSERVATIONS
  Mois relativement calme. L√©g√®re
  augmentation des tensions au bloc C
  suite aux travaux de r√©novation.
 
  Rapport complet disponible sur demande.`
};
 
// Bureau
document.getElementById('computer-icon').addEventListener('dblclick',()=>openExplorer('computer'));
document.getElementById('doc-icon').addEventListener('dblclick',openDocApp);
document.getElementById('documents-icon').addEventListener('dblclick',()=>openExplorer('documents'));
document.getElementById('email-icon').addEventListener('dblclick',openEmail);

// Population statistiques
const popIcon = document.getElementById('population-icon');
if(popIcon) popIcon.addEventListener('dblclick', openPopulationWindow);

// D√©mineur depuis le bureau
const minesweeperIcon = document.getElementById('minesweeper-icon');
if(minesweeperIcon) minesweeperIcon.addEventListener('dblclick', openMinesweeper);

// Internet Explorer
const internetIcon = document.getElementById('internet-icon');
if(internetIcon) internetIcon.addEventListener('dblclick', openInternet);

// Bloc-notes vide
const notepadIcon = document.getElementById('notepad-icon');
if(notepadIcon) notepadIcon.addEventListener('dblclick', () => openNotepad('Sans titre', ''));

// Calculatrice
const calculatorIcon = document.getElementById('calculator-icon');
if(calculatorIcon) calculatorIcon.addEventListener('dblclick', openCalculator);

// Panneau de configuration
const controlPanelIcon = document.getElementById('control-panel-icon');
if(controlPanelIcon) controlPanelIcon.addEventListener('dblclick', openControlPanel);

// Aide et support
const helpIcon = document.getElementById('help-icon');
if(helpIcon) helpIcon.addEventListener('dblclick', openHelp);

// Lecteur media
const mediaIcon = document.getElementById('media-player-icon');
if(mediaIcon) mediaIcon.addEventListener('dblclick', openMediaPlayer);

// CCTV
const cctvIcon = document.getElementById('cctv-icon');
if(cctvIcon) cctvIcon.addEventListener('dblclick', openCCTV);

// Fichiers du bureau
document.querySelectorAll('.desktop-icon[data-file]').forEach(icon=>{
  icon.addEventListener('dblclick',()=>{
    const filename=icon.dataset.file;
    if(desktopFiles[filename]){
      openNotepad(filename,desktopFiles[filename]);
    }
  });
});
 
// Explorateur
document.getElementById('explorer-close-btn').addEventListener('click',()=>{
  document.getElementById('explorer-window').style.display='none';
  removeTaskbarItem('explorer');
});

document.getElementById('back-btn').addEventListener('click',()=>{
  if(pathHistory.length>1){
    pathHistory.pop();
    const prevPath=pathHistory[pathHistory.length-1];
    pathHistory.pop();
    openExplorer(prevPath);
  }
});

document.getElementById('up-btn').addEventListener('click',()=>{
  const parts=currentPath.split('/');
  if(parts.length>1){
    parts.pop();
    openExplorer(parts.join('/')||'documents');
  }
});

document.getElementById('refresh-btn').addEventListener('click',()=>{
  const temp=currentPath;
  pathHistory.pop();
  openExplorer(temp);
});

document.querySelectorAll('.sidebar-item').forEach(item=>{
  item.addEventListener('click',function(){
    const path=this.dataset.path;
    if(path)openExplorer(path);
  });
});

// Bloc-notes
document.getElementById('notepad-close-btn').addEventListener('click',()=>{
  document.getElementById('notepad-window').style.display='none';
  removeTaskbarItem('notepad');
});

// D√©mineur
document.getElementById('minesweeper-close-btn').addEventListener('click',()=>{
  document.getElementById('minesweeper-window').style.display='none';
  removeTaskbarItem('minesweeper');
  if(gameInterval)clearInterval(gameInterval);
});

document.getElementById('new-game-btn').addEventListener('click',initMinesweeper);

// Calculatrice
document.getElementById('calculator-close-btn').addEventListener('click',()=>{
  document.getElementById('calculator-window').style.display='none';
  removeTaskbarItem('calculator');
});

// Internet Explorer
document.getElementById('internet-close-btn').addEventListener('click',()=>{
  document.getElementById('internet-window').style.display='none';
  removeTaskbarItem('internet');
});

// Panneau de configuration
document.getElementById('control-panel-close-btn').addEventListener('click',()=>{
  document.getElementById('control-panel-window').style.display='none';
  removeTaskbarItem('control-panel');
});

// Aide et support
document.getElementById('help-close-btn').addEventListener('click',()=>{
  document.getElementById('help-window').style.display='none';
  removeTaskbarItem('help');
});

// Lecteur media
document.getElementById('media-close-btn').addEventListener('click',()=>{
  document.getElementById('media-window').style.display='none';
  const audio=document.getElementById('media-audio');
  if(audio){
    audio.pause();
    audio.currentTime=0;
    audio.src='';
  }
  removeTaskbarItem('media');
});

// CCTV
document.getElementById('cctv-close-btn').addEventListener('click',()=>{
  document.getElementById('cctv-window').style.display='none';
  removeTaskbarItem('cctv');
});

const cctvRefreshBtn=document.getElementById('cctv-refresh-btn');
if(cctvRefreshBtn) cctvRefreshBtn.addEventListener('click',()=>{
  refreshCCTV();
  showNotification('üìπ','CCTV','Flux rafraichi');
});

const cctvLockBtn=document.getElementById('cctv-lockdown-btn');
if(cctvLockBtn) cctvLockBtn.addEventListener('click',()=>{
  const alerting=Math.random()>0.6;
  document.querySelectorAll('#cctv-grid .cctv-status').forEach(el=>{
    el.textContent=alerting?'D√©tection mouvement':'En ligne';
    el.classList.toggle('cctv-alert', alerting);
  });
  showNotification('üö®','CCTV','Bascule du mode veille');
});

// Email
document.getElementById('email-close-btn').addEventListener('click',()=>{
  document.getElementById('email-window').style.display='none';
  removeTaskbarItem('email');
});

document.querySelectorAll('.email-folder').forEach(folder=>{
  folder.addEventListener('click',function(){
    loadEmails(this.dataset.folder);
  });
});

// Calendrier
document.getElementById('calendar-close-btn').addEventListener('click',()=>{
  document.getElementById('calendar-window').style.display='none';
  removeTaskbarItem('calendar');
});

document.getElementById('prev-month-btn').addEventListener('click',()=>{
  currentMonth--;
  if(currentMonth<0){
    currentMonth=11;
    currentYear--;
  }
  renderCalendar();
});

document.getElementById('next-month-btn').addEventListener('click',()=>{
  currentMonth++;
  if(currentMonth>11){
    currentMonth=0;
    currentYear++;
  }
  renderCalendar();
});

// Param√®tres
document.getElementById('settings-close-btn').addEventListener('click',()=>{
  document.getElementById('settings-window').style.display='none';
  removeTaskbarItem('settings');
});

// D.O.C. Application
document.getElementById('close-btn').addEventListener('click',()=>{
  document.getElementById('main-window').style.display='none';
  removeTaskbarItem('doc');
  v='login';
  u=null;
  r='none';
  document.getElementById('email').value='';
  document.getElementById('password').value='';
});

function ren(){
  document.getElementById('login-view').style.display='none';
  document.getElementById('main-view').style.display='none';
  document.getElementById('detail-view').style.display='none';
  document.getElementById('form-view').style.display='none';
  const badge=document.getElementById('user-role-badge');
  if(badge&&r!=='none'){
    badge.textContent=r==='admin'?'ADMIN':'USER';
    badge.className=r==='admin'?'user-badge admin-badge':'user-badge';
  }
  if(v==='login')document.getElementById('login-view').style.display='flex';
  else if(v==='list'){
    document.getElementById('main-view').style.display='block';
    const b=document.getElementById('add-inmate-btn');
    if(b)b.style.display=r==='admin'?'inline-block':'none';
    lst(document.getElementById('search-input').value);
  }else if(v==='detail'){
    document.getElementById('detail-view').style.display='block';
    det(ci);
  }else if(v==='form'){
    document.getElementById('form-view').style.display='block';
    frm(ci);
  }
}

function lst(f=''){
  const l=document.getElementById('inmates-list');
  l.innerHTML='';
  const t=f.toLowerCase();
  const fi=inmates.filter(i=>i.name.toLowerCase().includes(t)||(i.alias&&i.alias.toLowerCase().includes(t))||(i.crimeDetails&&i.crimeDetails.toLowerCase().includes(t))||i.cell.toLowerCase().includes(t)||i.block.toLowerCase().includes(t));
  document.getElementById('no-results').classList.toggle('hidden',fi.length>0);
  fi.forEach(im=>{
    const c=document.createElement('div');
    c.className='inmate-card';
    c.innerHTML='<div class="inmate-card-header"><div class="inmate-avatar">üë§</div><div class="inmate-info"><div class="inmate-name">'+im.name+'</div><div class="inmate-alias">'+(im.alias?'"'+im.alias+'"':'Aucun alias')+'</div></div></div><div class="inmate-meta"><span class="inmate-meta-item meta-block">Bloc '+im.block+'</span><span class="inmate-meta-item meta-cell">Cellule '+im.cell+'</span><span class="inmate-meta-item meta-sentence '+(im.isLifeSentence?'sentence-life':'')+'">'+(im.isLifeSentence?'Perp√©tuit√©':(im.sentenceDuration||'N/A'))+'</span></div>';
    c.addEventListener('click',()=>shw('detail',im.id));
    l.appendChild(c);
  });
}

function det(id){
  const im=inmates.find(i=>i.id===id);
  if(!im){shw('list');return;}
  document.getElementById('detail-name').textContent=im.name;
  document.getElementById('detail-alias').textContent=im.alias?'Alias: "'+im.alias+'"':'Aucun alias connu';
  document.getElementById('detail-age').textContent=im.age+' ans';
  document.getElementById('detail-block').textContent='Bloc '+im.block;
  document.getElementById('detail-cell').textContent=im.cell;
  document.getElementById('detail-sentence').textContent=im.isLifeSentence?'Perp√©tuit√©':(im.sentenceDuration||'N/A');
  document.getElementById('detail-sentence').className='detail-grid-value'+(im.isLifeSentence?' sentence-life':'');
  document.getElementById('detail-start-date').textContent=im.startDate?new Date(im.startDate).toLocaleDateString('fr-FR'):'N/A';
  document.getElementById('detail-end-date').textContent=im.isLifeSentence?'Jamais':(im.endDate?new Date(im.endDate).toLocaleDateString('fr-FR'):'N/A');
  document.getElementById('detail-crime').textContent=im.crimeDetails||'Non sp√©cifi√©.';
  document.getElementById('detail-backstory').textContent=im.backstory||'Non sp√©cifi√©.';
  document.getElementById('detail-family').textContent=im.family||'Non sp√©cifi√©.';
  ['detail-crime','detail-backstory','detail-family'].forEach(id=>{
    const el=document.getElementById(id);
    if(r==='user')el.classList.add('blurred');
    else el.classList.remove('blurred');
  });
  const hn=im.adminNotes&&im.adminNotes.trim()!=='';
  if(r==='admin'){
    document.getElementById('detail-admin-buttons').classList.remove('hidden');
    document.getElementById('detail-admin-notes-section').classList.toggle('hidden',!hn);
    document.getElementById('detail-admin-notes').textContent=hn?im.adminNotes:'';
  }else{
    document.getElementById('detail-admin-buttons').classList.add('hidden');
    document.getElementById('detail-admin-notes-section').classList.add('hidden');
  }
}

function frm(id=null){
  document.getElementById('inmate-form').reset();
  document.getElementById('inmate-id').value='';
  document.getElementById('form-error').classList.add('hidden');
  document.getElementById('form-success').classList.add('hidden');
  document.getElementById('form-admin-notes-section').classList.toggle('hidden',r!=='admin');
  if(id){
    const im=inmates.find(i=>i.id===id);
    if(!im)return;
    document.getElementById('inmate-id').value=im.id;
    document.getElementById('name').value=im.name||'';
    document.getElementById('alias').value=im.alias||'';
    document.getElementById('age').value=im.age||'';
    document.getElementById('block').value=im.block||'';
    document.getElementById('cell').value=im.cell||'';
    document.getElementById('sentenceDuration').value=im.sentenceDuration||'';
    document.getElementById('startDate').value=im.startDate||'';
    document.getElementById('endDate').value=im.endDate||'';
    document.getElementById('isLifeSentence').checked=im.isLifeSentence||false;
    document.getElementById('crimeDetails').value=im.crimeDetails||'';
    document.getElementById('backstory').value=im.backstory||'';
    document.getElementById('family').value=im.family||'';
    document.getElementById('adminNotes').value=im.adminNotes||'';
  }
  tog();
}

function shw(vn,id=null){ci=id;v=vn;ren();}

function tog(){
  const l=document.getElementById('isLifeSentence').checked;
  document.getElementById('endDate').disabled=l;
  if(l)document.getElementById('endDate').value='';
}

// √âv√©nements de connexion
document.getElementById('login-btn').addEventListener('click',()=>{
  const e=document.getElementById('email').value.trim().toLowerCase();
  const p=document.getElementById('password').value.trim().toLowerCase();
  const le=document.getElementById('login-error');
  if(e==='admin'&&p==='admin'){
    u={email:e};r='admin';v='list';le.style.display='none';
    document.getElementById('start-menu-user-name').textContent='Administrateur';
    showNotification('‚úÖ','Connexion r√©ussie','Bienvenue Administrateur');
    setTimeout(()=>ren(),300);
  }else if(e==='user'&&p==='user'){
    u={email:e};r='user';v='list';le.style.display='none';
    document.getElementById('start-menu-user-name').textContent='Utilisateur';
    showNotification('‚úÖ','Connexion r√©ussie','Bienvenue Utilisateur');
    setTimeout(()=>ren(),300);
  }else{
    le.textContent="‚ö†Ô∏è Identifiant ou mot de passe incorrect.";
    le.style.display='block';
  }
});

document.getElementById('email').addEventListener('keypress',e=>{if(e.key==='Enter')document.getElementById('login-btn').click();});
document.getElementById('password').addEventListener('keypress',e=>{if(e.key==='Enter')document.getElementById('login-btn').click();});

const ab=document.getElementById('add-inmate-btn');
if(ab)ab.addEventListener('click',()=>shw('form'));

const bb=document.getElementById('back-to-list-btn');
if(bb)bb.addEventListener('click',()=>shw('list'));

const bf=document.getElementById('back-from-form-btn');
if(bf)bf.addEventListener('click',()=>{const id=document.getElementById('inmate-id').value;shw(id?'detail':'list',id||null);});

const si=document.getElementById('search-input');
if(si)si.addEventListener('input',e=>lst(e.target.value));

const f=document.getElementById('inmate-form');
if(f)f.addEventListener('submit',e=>{
  e.preventDefault();
  if(r!=='admin')return;
  document.getElementById('form-error').classList.add('hidden');
  document.getElementById('form-success').classList.add('hidden');
  const d={name:document.getElementById('name').value.trim(),alias:document.getElementById('alias').value.trim(),age:parseInt(document.getElementById('age').value,10),block:document.getElementById('block').value.trim().toUpperCase(),cell:document.getElementById('cell').value.trim(),sentenceDuration:document.getElementById('sentenceDuration').value.trim(),startDate:document.getElementById('startDate').value,endDate:document.getElementById('endDate').value,isLifeSentence:document.getElementById('isLifeSentence').checked,crimeDetails:document.getElementById('crimeDetails').value.trim(),backstory:document.getElementById('backstory').value.trim(),family:document.getElementById('family').value.trim(),adminNotes:document.getElementById('adminNotes').value.trim()};
  if(!d.name||!d.age||!d.block||!d.cell){
    document.getElementById('form-error').textContent="Les champs Nom, √Çge, Bloc et Cellule sont obligatoires.";
    document.getElementById('form-error').classList.remove('hidden');
    return;
  }
  const id=document.getElementById('inmate-id').value;
  if(id){
    const ix=inmates.findIndex(i=>i.id===id);
    if(ix!==-1)inmates[ix]={...inmates[ix],...d};
    document.getElementById('form-success').textContent="‚úì Dossier modifi√© avec succ√®s !";
  }else{
    d.id=Date.now().toString();
    inmates.push(d);
    document.getElementById('form-success').textContent="‚úì D√©tenu ajout√© avec succ√®s !";
  }
  document.getElementById('form-success').classList.remove('hidden');
  inmates.sort((a,b)=>a.name.localeCompare(b.name));
  setTimeout(()=>shw('list'),1500);
});

const cf=document.getElementById('cancel-form-btn');
if(cf)cf.addEventListener('click',()=>{const id=document.getElementById('inmate-id').value;shw(id?'detail':'list',id||null);});

const ls=document.getElementById('isLifeSentence');
if(ls)ls.addEventListener('change',tog);

const eb=document.getElementById('edit-inmate-btn');
if(eb)eb.addEventListener('click',()=>shw('form',ci));

const db=document.getElementById('delete-inmate-btn');
if(db)db.addEventListener('click',()=>{if(r!=='admin'||!ci)return;dt=ci;document.getElementById('delete-modal').style.display='flex';});

const cd=document.getElementById('confirm-delete-btn');
if(cd)cd.addEventListener('click',()=>{if(dt){inmates=inmates.filter(i=>i.id!==dt);dt=null;document.getElementById('delete-modal').style.display='none';shw('list');}});

const ca=document.getElementById('cancel-delete-btn');
if(ca)ca.addEventListener('click',()=>{dt=null;document.getElementById('delete-modal').style.display='none';});

window.addEventListener('load',bios);

// Population window function
function openPopulationWindow(){
  const win = document.getElementById('population-window');
  if(!win) return;
  win.style.display = 'block';
  try { addTaskbarItem('population','Population'); } catch(e){}
  document.getElementById('population-close-btn').onclick = () => {
    win.style.display = 'none';
    removeTaskbarItem('population');
  };
  
  function renderCharts(){
    try {
      // Chart.js line chart - Population trend
      const trendCtx = document.getElementById('population-trend').getContext('2d');
      const months = ['Jan','F√©v','Mar','Avr','Mai','Jun','Jul','Aou','Sep','Oct','Nov','D√©c'];
      const trend = [820,825,832,828,835,840,852,858,861,855,860,868];
      
      if(window._popTrend) window._popTrend.destroy();
      window._popTrend = new Chart(trendCtx, {
        type:'line',
        data: {
          labels: months,
          datasets: [{ label:'Population', data:trend, borderColor:'#1a5cb8', backgroundColor:'rgba(26,92,184,0.1)', tension:0.3, fill:true }]
        },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}} }
      });

      // Bar chart - Population by block
      const blockCtx = document.getElementById('population-by-block').getContext('2d');
      const blocks = ['A','B','C','D','E','F'];
      const blockPop = [155,142,158,148,132,133];
      
      if(window._popBlock) window._popBlock.destroy();
      window._popBlock = new Chart(blockCtx, {
        type:'bar',
        data: {
          labels: blocks,
          datasets: [{ label:'D√©tenus', data:blockPop, backgroundColor:['#3498db','#2ecc71','#f39c12','#e74c3c','#9b59b6','#1abc9c'] }]
        },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
      });

      // Pie chart - Classification
      const typeCtx = document.getElementById('population-by-type').getContext('2d');
      const types = ['Non-violent','Violent','Col.blanc','Drogue'];
      const typePop = [380,280,108,100];
      
      if(window._popType) window._popType.destroy();
      window._popType = new Chart(typeCtx, {
        type:'doughnut',
        data: {
          labels: types,
          datasets: [{ data:typePop, backgroundColor:['#2ecc71','#e74c3c','#f39c12','#9b59b6'] }]
        },
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom',labels:{boxWidth:12,font:{size:10}}}} }
      });
    } catch(err) { console.warn('Chart error:', err); }
  }

  if(window.Chart) renderCharts();
  else {
    const s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/npm/chart.js';
    s.onload = renderCharts;
    s.onerror = () => console.error('Erreur chargement Chart.js');
    document.head.appendChild(s);
  }
}
</script>
  <script>
// Desktop drag-and-drop script inlined from desktop.js
(function(){
  document.addEventListener('DOMContentLoaded', ()=>{
    const container = document.getElementById('desktop-icons');
    if(!container) return;

    // inject minimal styles needed for dragging
    const style = document.createElement('style');
    style.textContent = `
      .desktop-icon { touch-action: none; user-select: none; }
      .desktop-icon.dragging { cursor: grabbing; opacity: 0.95; transform: translateZ(0); }
    `;
    document.head.appendChild(style);

    const icons = Array.from(container.querySelectorAll('.desktop-icon'));
    let containerRect = null;

    // Configuration fixe de la grille - SANS CHEVAUCHEMENT
    const padding = 15;
    const gapX = 12;
    const gapY = 15;
    const cellW = 85; // Largeur fixe pour chaque cellule (ic√¥ne + gap)
    const cellH = 100; // Hauteur fixe pour chaque cellule (ic√¥ne + gap)
    const maxCols = 2; // 2 colonnes d'ic√¥nes (arrangement vertical comme GrandLine XP)

    // initialiser les positions FIXES sans chevauchement
    requestAnimationFrame(() => {
      containerRect = container.getBoundingClientRect();
      icons.forEach((icon, idx) => {
        const id = icon.id || (`icon-${idx}`);
        if(!icon.id) icon.id = id;
        
        // Positionnement en grille stricte - colonnes verticales comme GrandLine XP
        const col = Math.floor(idx / 8); // Nouvelle colonne tous les 8 ic√¥nes
        const row = idx % 8;
        const left = padding + col * cellW;
        const top = padding + row * cellH;
        
        icon.style.margin = '0';
        icon.style.position = 'absolute';
        icon.style.zIndex = 1;
        icon.style.left = left + 'px';
        icon.style.top = top + 'px';
      });
    });

    let zIndex = 2;

    function snapToGrid(left, top){
      // Snap position to nearest grid cell (style GrandLine XP - colonnes verticales)
      const snappedCol = Math.round((left - padding) / cellW);
      const snappedRow = Math.round((top - padding) / cellH);
      const snappedLeft = padding + snappedCol * cellW;
      const snappedTop = padding + snappedRow * cellH;
      return { left: Math.max(padding, snappedLeft), top: Math.max(padding, snappedTop) };
    }

    function savePositions(){
      // Les positions sont maintenant toujours dans la grille fixe, pas besoin de sauvegarder
      return;
    }

    icons.forEach(icon => {
      icon.addEventListener('pointerdown', (e) => {
        const startX = e.clientX;
        const startY = e.clientY;
        containerRect = container.getBoundingClientRect();
        const rect = icon.getBoundingClientRect();
        const offsetX = e.clientX - rect.left;
        const offsetY = e.clientY - rect.top;
        let draggingStarted = false;
        try { icon.setPointerCapture(e.pointerId); } catch(err){}

        function onMove(ev){
          const dx = ev.clientX - startX;
          const dy = ev.clientY - startY;
          if(!draggingStarted){
            if(Math.hypot(dx,dy) < 6) return; // small movement -> treat as click
            draggingStarted = true;
            icon.classList.add('dragging');
            icon.style.zIndex = ++zIndex;
            containerRect = container.getBoundingClientRect();
          }
          const cx = ev.clientX;
          const cy = ev.clientY;
          let left = cx - containerRect.left - offsetX + container.scrollLeft;
          let top = cy - containerRect.top - offsetY + container.scrollTop;
          const maxLeft = Math.max(0, container.clientWidth - icon.offsetWidth);
          const maxTop = Math.max(0, container.clientHeight - icon.offsetHeight);
          left = Math.max(0, Math.min(left, maxLeft));
          top = Math.max(0, Math.min(top, maxTop));
          icon.style.left = Math.round(left) + 'px';
          icon.style.top = Math.round(top) + 'px';
        }
        function onUp(ev){
          try { icon.releasePointerCapture(e.pointerId); } catch(err){}
          document.removeEventListener('pointermove', onMove);
          document.removeEventListener('pointerup', onUp);
          if(draggingStarted){
            icon.classList.remove('dragging');
            // Snap to grid on drop
            const left = parseInt(icon.style.left)||0;
            const top = parseInt(icon.style.top)||0;
            const snapped = snapToGrid(left, top);
            icon.style.left = snapped.left + 'px';
            icon.style.top = snapped.top + 'px';
            savePositions();
          }
        }
        document.addEventListener('pointermove', onMove);
        document.addEventListener('pointerup', onUp);
      });
      // prevent native drag
      icon.addEventListener('dragstart', e => e.preventDefault());
    });

    // save once on unload
    window.addEventListener('beforeunload', savePositions);

    // optional: clamp positions if container resizes
    window.addEventListener('resize', ()=>{
      containerRect = container.getBoundingClientRect();
      const savedNow = JSON.parse(localStorage.getItem('desktop_positions') || '{}');
      let changed = false;
      icons.forEach(icon => {
        const maxLeft = Math.max(0, container.clientWidth - icon.offsetWidth);
        const maxTop = Math.max(0, container.clientHeight - icon.offsetHeight);
        const left = Math.max(0, Math.min(parseInt(icon.style.left)||0, maxLeft));
        const top = Math.max(0, Math.min(parseInt(icon.style.top)||0, maxTop));
        if((savedNow[icon.id] && (savedNow[icon.id].left !== left || savedNow[icon.id].top !== top)) || !savedNow[icon.id]){
          savedNow[icon.id] = { left, top };
          changed = true;
        }
        icon.style.left = left + 'px';
        icon.style.top = top + 'px';
      });
      if(changed) localStorage.setItem('desktop_positions', JSON.stringify(savedNow));
    });
  });
})();

  </script>
</body>
</html>
